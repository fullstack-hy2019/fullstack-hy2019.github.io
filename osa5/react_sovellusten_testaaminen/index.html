<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/0.cfc6744424f23f9f1dc5.css">@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,500,600);@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400);.element--flex{display:flex;flex-wrap:wrap}.element--space-around{justify-content:space-around}.element--space-between{justify-content:space-between}.element--column{flex-direction:column}.element--centered{align-items:center;justify-content:center!important}@media (min-width:992px){.element--centered-in-desktop{align-items:center;justify-content:center!important}}@media (min-width:992px){.element--horizontal-half{width:45%}}.element--auto-margin{margin:auto}.element--auto-bottom-margin{margin-bottom:auto}.element--flex-start{align-content:flex-start}.element--no-wrap{flex-wrap:nowrap}.element--relative{position:relative!important}.image__content{position:absolute;top:0;left:0;height:100%;width:100%;-o-object-fit:cover;object-fit:cover}.image--contain .image__content{-o-object-fit:contain;object-fit:contain}.image{overflow:hidden;width:100%;position:relative}@media (min-width:992px){.image{width:40%}}.image .image__container{height:0;position:relative;width:100%;padding-bottom:89.0625%}.image--circle{border-radius:50%}.image--circle .image__content{background-color:#e1e1e1}.image--square-big{width:100%}.image--square-big .image__container{width:100%;padding-bottom:100%}.image--extra-small{width:8%}.image--extra-small .image__container{width:100%;padding-bottom:100%}@media (max-width:639px){.image--extra-small{width:calc(33.33333% - 1rem)}}.image--small{width:15%}.image--small .image__container{width:100%;padding-bottom:100%}@media (max-width:639px){.image--small{width:calc(33.33333% - 1rem)}}.image--medium{width:50%}.image--medium .image__container{width:100%;padding-bottom:71.25%}.image--large{width:100%}@media (min-width:992px){.image--large{width:60%}}.image--large .image__container{padding-bottom:59.37%;width:100%}.image--full-width{width:100%}.image--full-width .image__container{padding-bottom:59.37%;width:100%}.image--actual-size{width:100%}.image--actual-size .image__container{height:0;position:relative;width:100%;padding-bottom:60%}.navigation{z-index:2;list-style:none;opacity:0;display:none;margin:0;padding:5%;flex-direction:column;justify-content:center;align-items:center;background:#e1e1e1;position:fixed;top:8%;right:5%;transition:opacity .3s ease-in-out;font-weight:200}@media (min-width:640px){.navigation{display:flex;opacity:1;padding:0;font-weight:400;position:static;background:none;overflow:hidden;flex-direction:row}}.navigation__toggle{z-index:3;position:absolute;top:0;right:0;width:50px;height:40px;cursor:pointer;border:none;background:none;outline:none;border-radius:4px}@media (min-width:640px){.navigation__toggle{display:none}}.navigation__mobile-logo{display:none}.navigation__toggle-icon{top:8px;left:10px}.navigation__toggle-icon,.navigation__toggle-icon:after,.navigation__toggle-icon:before{position:absolute;width:30px;height:3px;transition:all .3s ease;border-radius:4px;background-color:#33332d}.navigation__toggle-icon:after,.navigation__toggle-icon:before{content:"";display:block}.navigation__toggle-icon:before{top:10px}.navigation__toggle-icon:after{top:20px}.is-open--navigation{overflow:hidden}.is-open--navigation .navigation{opacity:1;display:unset}.is-open--navigation .navigation:before{content:"";background-color:#e1e1e1;position:absolute;width:25px;height:25px;top:-3px;right:13px;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.is-open--navigation .navigation__mobile-logo{display:block;width:30px;height:30px;position:absolute;top:47px;left:5%}@media (min-width:640px){.is-open--navigation .navigation__mobile-logo{display:none}}.is-open--navigation .navigation__toggle-icon{-webkit-transform:translate3d(0,10px,0) rotate(45deg);transform:translate3d(0,10px,0) rotate(45deg)}.is-open--navigation .navigation__toggle-icon,.is-open--navigation .navigation__toggle-icon:after,.is-open--navigation .navigation__toggle-icon:before{background:#33332d}.is-open--navigation .navigation__toggle-icon:before{-webkit-transform:rotate(-45deg) translate3d(-5.71429px,-6px,0);transform:rotate(-45deg) translate3d(-5.71429px,-6px,0);opacity:0}.is-open--navigation .navigation__toggle-icon:after{-webkit-transform:translate3d(0,-19px,0) rotate(-90deg);transform:translate3d(0,-19px,0) rotate(-90deg)}.navigation__item{margin:22px 0;white-space:nowrap}.navigation__item:first-of-type{margin:0 0 22px}.navigation__item:last-of-type{margin:22px 0 0}@media (min-width:640px){.navigation__item{margin:0 30px;padding:0!important}.navigation__item:first-of-type{margin:0 30px 0 2rem}.navigation__item:last-of-type{margin:0 0 0 30px}}html{font-family:IBM Plex Mono,monospace;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:IBM Plex Mono,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em IBM Plex Mono,monospace;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:IBM Plex Mono,monospace;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{margin:2rem 0 -.5rem;font-size:1.38316rem}h3,h4{padding:0;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{margin:2rem 0 -1rem;font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}body,html{margin:0;padding:0;font-family:IBM Plex Mono,monospace;font-weight:500;color:#33332d;font-size:14px;line-height:1.555rem}@media (min-width:992px){body,html{font-size:18px}}p{margin:0;text-align:left;line-height:1.5em}a,p{color:#33332d}a{text-decoration:none}.link a{border-bottom:2px solid #e1e1e1}.link a:hover{background-color:#e1e1e1}.container{position:relative;margin:0 auto;display:flex;flex-wrap:wrap;justify-content:space-between;width:90%;max-width:1200px}@media (min-width:992px){.container--right{margin-right:5%;width:54%;max-width:719.9856px}}@media (min-width:992px) and (min-width:1200px){.container--right{margin-right:calc((100% - 1200px)/2)}}.hidden{display:none!important}.centered{text-align:center}@media (max-width:639px){.centered--mobile{justify-content:center;align-content:center;align-items:center}}.spacing{margin-top:2rem}@media (min-width:992px){.spacing{margin-top:5rem}}.spacing--small{margin-top:1rem}@media (min-width:992px){.spacing--small{margin-top:3.444rem}}.spacing--large{margin-top:4rem}@media (min-width:992px){.spacing--large{margin-top:10rem}}.spacing--extra-large{margin-top:4rem}@media (min-width:992px){.spacing--extra-large{margin-top:20rem}}.spacing--after{margin-bottom:2rem}@media (min-width:992px){.spacing--after{margin-bottom:5rem}}@media (min-width:992px){.spacing--after-small{margin-bottom:2.5rem}}.spacing--after-large{margin-bottom:4rem}@media (min-width:992px){.spacing--after-large{margin-bottom:10rem}}@media (max-width:991px){.spacing--mobile{margin-top:2rem}}.col-1{width:100%}@media (min-width:992px){.col-1{width:10%}}.col-2{width:100%}@media (min-width:992px){.col-2{width:20%}}.col-3{width:100%}@media (min-width:992px){.col-3{width:30%}}.col-4{width:100%}@media (min-width:992px){.col-4{width:40%}}.col-5{width:100%}@media (min-width:992px){.col-5{width:50%}}.col-6{width:100%}@media (min-width:992px){.col-6{width:60%}}.col-7{width:100%}@media (min-width:992px){.col-7{width:70%}}.col-8{width:100%}@media (min-width:992px){.col-8{width:80%}}.col-9{width:100%}@media (min-width:992px){.col-9{width:90%}}.col-10{width:100%}@media (min-width:992px){.col-10{width:100%}}@media (min-width:992px){.push-right-1{margin-left:10%}.push-right-2{margin-left:20%}.push-right-3{margin-left:30%}.push-right-4{margin-left:40%}.push-right-5{margin-left:50%}.push-left-1{margin-right:10%}.push-left-2{margin-right:20%}.push-left-3{margin-right:30%}.push-left-4{margin-right:40%}.push-left-5{margin-right:50%}.push-left{margin-right:auto}.push-right{margin-left:auto}}@media (max-width:991px){.col-1--mobile{width:10%}.col-2--mobile{width:20%}.col-3--mobile{width:30%}.col-4--mobile{width:40%}.col-5--mobile{width:50%}.col-6--mobile{width:60%}.col-7--mobile{width:70%}.col-8--mobile{width:80%}.col-9--mobile{width:90%}.col-10--mobile{width:100%}.order-0--mobile{order:0}.order-1--mobile{order:1}.order-2--mobile{order:2}.order-3--mobile{order:3}.order-4--mobile{order:4}.order-5--mobile{order:5}.hidden--mobile{display:none}}.centered-vertically{display:flex;flex-direction:column;justify-content:center}.nav-item-hover{text-decoration:none;color:#33332d;font-weight:500;padding:.2em}@media (min-width:640px){.nav-item-hover{font-weight:600;font-size:1.111rem}}.nav-item-hover:active,.nav-item-hover:focus,.nav-item-hover:hover{color:#fff;background-color:#33332d}.nav-item-hover:active,.nav-item-hover:focus{outline:2px solid #706be4}.flex-fix-aligning:after,.flex-fix-aligning:before{content:"";width:30%;order:2}.index__main-title{font-size:1.571rem}@media (min-width:992px){.index__main-title{font-size:3rem}}.auto-bottom-margin{margin-bottom:auto}@media (min-width:992px){.absolute-top-right--desktop{position:absolute;top:0;right:0}}@media (min-width:640px){.frontpage__hero .image{top:-2em}}@media (min-width:992px){.frontpage__hero{flex-direction:column}.frontpage__hero .image{top:4em}}.heading-font{font-family:IBM Plex Sans,monospace}.header{position:-webkit-sticky;position:sticky;z-index:200;top:0;transition:top .2s ease-in-out;box-sizing:border-box;width:100%;padding-top:1.444rem;padding-bottom:1rem;transition:all .2s ease-in-out}.header__logo{margin:0 10px}.triple-border{position:relative;padding:2px;border-radius:5px 0;transition:color .1s ease-in-out,background-color .1s ease-in-out}.triple-border:after,.triple-border:before{content:"";border:2px solid #33332d;border-radius:5px;position:absolute;width:calc(100% + 5px);height:calc(100% + 5px)}.triple-border:before{left:0;top:0}.triple-border:after{bottom:0;right:0}.triple-border__container{overflow:hidden;border-radius:3px 0}.triple-border--large-margin{margin:13px;padding:3px}.triple-border--large-margin:after,.triple-border--large-margin:before{content:"";border-width:3px;border-radius:13px;width:calc(100% + 13px);height:calc(100% + 13px)}.triple-border--large-margin .triple-border__container{border-radius:10px 0}.triple-border__logo{padding:.2rem;font-size:1.111rem;font-weight:600}.triple-border__return-tasks{font-size:.9rem;padding:1rem .2rem}</style><style data-href="/app.f588656cc80a065e5f1e.css">code[class*=language-],pre[class*=language-]{color:#fff;background:none;text-shadow:0 -.1em .2em #000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}:not(pre)>code[class*=language-],pre[class*=language-]{background:#4d4033}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:.3em solid #7a6652;border-radius:.5em;box-shadow:inset 1px 1px .5em #000}:not(pre)>code[class*=language-]{padding:.15em .2em .05em;border-radius:.3em;border:.13em solid #7a6652;box-shadow:inset 1px 1px .3em -.1em #000;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#998066}.namespace,.token.punctuation{opacity:.7}.token.boolean,.token.constant,.token.number,.token.property,.token.symbol,.token.tag{color:#d1949e}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#bde052}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f5b83d}.token.atrule,.token.attr-value,.token.keyword{color:#d1949e}.token.important,.token.regex{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.deleted{color:red}</style><style data-href="/component---src-templates-content-template-js.59a575ad88fdbaeba17d.css">@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,500,600);@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400);.course{position:relative;width:100%}.course p{font-family:IBM Plex Sans,monospace}@media (min-width:640px){.course p{margin-left:1rem}}.course p:not(:last-of-type){margin-bottom:1rem}@media (min-width:640px){.course h1{margin-left:3rem}}.course h2,.course h3,.course h4{padding-bottom:2rem}@media (min-width:640px){.course h2,.course h3,.course h4,.course table{margin-left:1rem}}.course ul{font-family:IBM Plex Sans,monospace}@media (min-width:640px){.course ul{margin-left:2.2rem}}.course h2:not(:first-of-type){margin-top:2rem}.course pre{margin:2rem 0;background-color:#33332d;color:#fff}.course em{font-family:Courier;font-style:normal;background-color:hsla(0,0%,88.2%,.6);padding:1px 5px 2px}.course img{border:11px solid transparent}.course .banner,.course .container{position:static}.course .letter{width:4rem;height:4rem;border-width:5px;border-style:solid;border-radius:2.5rem;text-align:center;margin:1rem;line-height:1.3em;-webkit-transform:translate(-1rem);transform:translate(-1rem)}@media (min-width:640px){.course .letter{-webkit-transform:translate(-3rem,4.5rem);transform:translate(-3rem,4.5rem)}}.course .letter,.course h1{font-size:2.3rem;font-weight:700}.course-content a,.tasks a{border:0;border-bottom-width:2px;border-style:solid;padding:2px}.course-content{max-width:100%}.tasks a{border-color:#33332d!important}.tasks a:hover{background-color:#fff!important;color:#000!important}.gatsby-highlight-code-line{background-color:hsla(0,0%,88.2%,.3);display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:1em}code[class*=language-],pre[class*=language-]{text-shadow:none}.arrow-go-up{width:36px;height:36px;position:fixed;bottom:5%;right:5%;z-index:99999;cursor:pointer}@media (max-width:639px){.arrow-go-up{right:10%}}.arrow__container{position:relative}.arrow__container:not():first-child{background:none;background-color:none}@media (min-width:640px){.arrow__container:not():first-child{border-left:none}.arrow__container:not():first-child:before{content:"";background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NzcuMTc1IDQ3Ny4xNzUiPjxwYXRoIGQ9Ik0zNjAuNzMxIDIyOS4wNzVsLTIyNS4xLTIyNS4xYy01LjMtNS4zLTEzLjgtNS4zLTE5LjEgMHMtNS4zIDEzLjggMCAxOS4xbDIxNS41IDIxNS41LTIxNS41IDIxNS41Yy01LjMgNS4zLTUuMyAxMy44IDAgMTkuMSAyLjYgMi42IDYuMSA0IDkuNSA0IDMuNCAwIDYuOS0xLjMgOS41LTRsMjI1LjEtMjI1LjFjNS4zLTUuMiA1LjMtMTMuOC4xLTE5eiIvPjwvc3ZnPg==) no-repeat;background-size:contain;position:absolute;top:0;left:0;height:100%;width:100%}}.arrows--horizontal{display:flex;position:relative;margin:0;align-items:flex-start}.arrow__wrapper{display:flex;justify-content:flex-start;align-items:center;margin:0}.arrow__wrapper:first-of-type{border-right:none;z-index:20}.arrow__wrapper:nth-of-type(n+2){margin-left:-4rem;z-index:10}.arrow__wrapper:nth-of-type(n+2) .arrow__rectangle{border-left:none;padding-left:4rem}.arrow__wrapper:nth-of-type(3){z-index:5}.arrow__wrapper:hover .arrow__point,.arrow__wrapper:hover .arrow__rectangle,.arrow__wrapper:hover .arrow__rectangle>a{background-color:#33332d!important;color:#fff!important}.arrow__rectangle{padding:1rem;justify-content:center;align-items:center;border:2px solid #33332d;border-right:none;z-index:2;overflow:hidden;font-family:IBM Plex Sans,monospace;position:relative}@media (max-width:991px){.arrow__rectangle{font-size:.7rem}}.arrow__rectangle .bold{font-weight:600}.arrow__rectangle--thick-border{border:3px solid #33332d;border-right:none}.arrow__point{padding:1.25rem;border:2px solid #33332d;border-bottom:none;border-left:none;-webkit-transform:translate(-1.3rem) rotate(45deg);transform:translate(-1.3rem) rotate(45deg);z-index:1;overflow:hidden}.arrow__point--thick-border{border:3px solid #33332d;border-bottom:none;border-left:none}.arrow__wrapper--stacked{display:flex;justify-content:flex-start;align-items:center;margin:auto auto auto 0}.arrow__wrapper--stacked:nth-of-type(n+2){margin-top:1rem}@media (min-width:640px){.arrow__wrapper--stacked:nth-of-type(n+2){margin-top:-2px}}.arrow__wrapper--stacked .arrow__rectangle{position:relative}@media (min-width:640px){.arrow__wrapper--stacked .arrow__rectangle{padding:1.25rem}}@media (min-width:992px){.arrow__wrapper--stacked .arrow__rectangle{padding:1rem}}.arrow__wrapper--stacked .arrow__point{padding:1.08rem;margin-left:2px}@media (min-width:640px){.arrow__wrapper--stacked .arrow__point{margin-left:unset;padding:1.25rem}}.arrow__wrapper--stacked:hover .arrow__point,.arrow__wrapper--stacked:hover .arrow__rectangle{background-color:#33332d!important}.arrow__wrapper--stacked:hover .arrow--stacked-letter,.arrow__wrapper--stacked:hover .arrow--stacked-title{color:#fff}.arrow--stacked-letter{margin-right:2rem}.arrow--stacked-title{white-space:nowrap;font-family:IBM Plex Mono,monospace}.arrow__container--with-link{width:100%!important}@media (max-width:639px){.breadcrumb .arrow__wrapper{padding:0}.breadcrumb .arrow__wrapper:not(:last-of-type):after{content:">";font-size:.7rem;font-weight:400;margin:0 .5rem}}.breadcrumb .arrow__wrapper:hover .arrow__point,.breadcrumb .arrow__wrapper:hover .arrow__rectangle{background-color:#33332d!important}.breadcrumb .arrow__wrapper:hover .arrow--stacked-letter,.breadcrumb .arrow__wrapper:hover .arrow--stacked-title{color:#fff}.breadcrumb .arrow__rectangle{position:relative}@media (max-width:639px){.breadcrumb .arrow__rectangle{border:none;padding:0;font-size:.7rem;white-space:nowrap;background-color:transparent!important;color:#33332d}}@media (max-width:639px){.breadcrumb .arrow__point{display:none}}.banner{display:flex;width:100%;align-items:center;position:relative;padding:2rem 0;background-color:#e1e1e1}@media (min-width:992px){.banner{padding:3.444rem 3.444rem 4.444rem}}.edit-link{border-bottom-width:3px;border-bottom-style:solid}@media (min-width:992px){#footer{align-items:center}}#footer .footer__navigation-link{font-size:1rem;line-height:18px;white-space:nowrap;font-family:IBM Plex Sans,monospace;margin-left:0!important}#footer .footer__navigation-link:nth-of-type(n+2){margin-top:2.142rem}@media (min-width:992px){#footer .footer__navigation{flex-direction:row;flex-wrap:nowrap;justify-content:flex-end}#footer .footer__navigation-link{margin-top:0!important;margin-bottom:auto}#footer .footer__navigation-link:nth-of-type(n+1){margin-right:2.877rem}#footer .footer__navigation-link:last-of-type{margin-right:0!important}}.prev-next__container .separator{display:none}@media (max-width:639px){.prev-next__container .separator{display:block;background-color:#33332d;width:2px}}.prev-next__container .prev b,.prev-next__container .prev p{text-align:right}@media (max-width:639px){.prev-next__container .prev p:before{content:"<";margin-right:1rem}}@media (max-width:639px){.prev-next__container .next p:after{content:">";margin-left:1rem}}.body-text:not(:last-of-type){margin-bottom:2.5rem}.body-text__title{color:#33332d;font-size:1.44rem;line-height:1.25em;font-weight:700;margin:0;position:relative;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.body-text__content:not(:last-of-type){padding-bottom:2em}.bold{font-weight:700}.body-text--no-padding{padding:0!important}.scroll-navigation{font-size:16px;position:absolute;width:30%;left:0;top:198px;padding-right:1rem;z-index:199}@media (max-width:991px){.scroll-navigation{display:none}}.scroll-navigation li{list-style-type:none}.scroll-navigation li:hover{cursor:pointer}.scroll-navigation li:hover a{background-color:#33332d;color:#fff!important}.scroll-navigation li:before{content:"-"}.left-navigation-link{padding-left:1.2rem;text-indent:-1.2rem}.left-navigation-link:hover{background-color:#33332d!important;color:#fff!important}.level-h1{font-weight:700;padding-left:2.8rem;text-indent:-2.8rem}.level-h2{padding-left:1.6rem;text-indent:-1.6rem}.accordion__container{margin-bottom:1rem}.accordion__title{padding-left:2.149rem!important;padding-right:2.149rem!important;font-size:1.111rem!important;font-weight:600}.accordion{background-color:#fff;border:3px solid #33332d;border-radius:5px;color:#444;cursor:pointer;padding:1rem;width:100%;text-align:left;outline:none;font-size:15px;transition:max-width .4s}.accordion:hover,.active{background-color:#e1e1e1}.accordion:after{content:"\2795";font-size:1rem;float:right;margin-left:5px}.active{border-color:#fff}.active:after{content:"\2796"}.panel{background-color:#fff;transition:height .3s;transition-timing-function:ease-in-out;overflow:hidden}.accordion--side-navigation{width:100%;margin-left:unset}.accordion--side-navigation .accordion{border:none;padding:0!important;background-color:transparent!important;color:#33332d!important;border-radius:0}.accordion--side-navigation .accordion__title{font-size:16px!important;font-weight:unset;background-color:transparent}.accordion--side-navigation .accordion__title:hover{background-color:#33332d!important;color:#fff!important}.accordion--side-navigation .panel{padding:1rem 0 0!important;background-color:transparent}.accordion--side-navigation .panel ul{margin-left:1rem}.accordion--side-navigation .accordion:hover,.accordion--side-navigation .active{background-color:#33332d;color:#fff}.accordion--side-navigation .accordion:after,.accordion--side-navigation .active:after{content:""}.sub-header{color:#33332d;font-family:IBM Plex Mono,monospace;padding-bottom:1.357rem}@media (min-width:992px){.sub-header{padding-bottom:2.333rem}}</style><meta name="generator" content="Gatsby 2.0.53"/><title data-react-helmet="true">Fullstack osa5 |  | Fullstack 2019</title><meta data-react-helmet="true" name="description" content=""/><meta data-react-helmet="true" property="og:title" content="Fullstack osa5 | "/><meta data-react-helmet="true" property="og:description" content=""/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Houston Inc. Consulting oy"/><meta data-react-helmet="true" name="twitter:title" content="Fullstack osa5 | "/><meta data-react-helmet="true" name="twitter:description" content=""/><meta data-react-helmet="true" name="keywords" content="Fullstack, "/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link as="script" rel="preload" href="/app-2c491ec1dd58eba53a73.js"/><link as="script" rel="preload" href="/1-072e5cd30afe3d25b43a.js"/><link as="script" rel="preload" href="/component---src-templates-content-template-js-45199be9da0474ef210f.js"/><link as="script" rel="preload" href="/2-8cb475ac5ceeb60d8393.js"/><link as="script" rel="preload" href="/0-87340ba4bd0a15678a60.js"/><link as="script" rel="preload" href="/3-581fe0821230e9175114.js"/><link as="script" rel="preload" href="/webpack-runtime-4c016d368e8717b20ee1.js"/><link rel="preload" href="/static/d/407/path---osa-5-react-sovellusten-testaaminen-108-c64-dKr5C2ZkAS7uKQvJA4dmB25Wbkg.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="header " style="background-color:white"><div class="container" style="align-items:center;justify-content:flex-start"><a class="header__logo" href="/"><div class="triple-border nav-item-hover " style="padding:0.2em"><div class="triple-border__container triple-border__logo" style="background-color:transparent">{() =&gt; fs}</div></div></a><div class="navigation__wrapper "><button aria-label="Navigation menu" aria-expanded="false" class="navigation__toggle"><div class="navigation__toggle-icon"></div></button><nav><ul class="navigation"><li class="navigation__item "><a class="nav-item-hover" href="/about">KURSSISTA</a></li><li class="navigation__item "><a class="nav-item-hover" href="/#course-contents">KURSSIN SISÄLTÖ</a></li><li class="navigation__item "><a class="nav-item-hover" href="/faq">FAQ</a></li></ul></nav></div></div></div><div class="course-container spacing--after"><div class="banner " style="background-image:url(/static/part-5-1d38df3161654915a233d16795c6c490.svg);background-position:center center;background-size:50%;background-repeat:no-repeat;background-color:#E693CB"><div class="container spacing--after"><div class="col-10 spacing--after"><div class="arrow__container arrows--horizontal breadcrumb"><div class="arrow__wrapper"><div class="arrow__rectangle  " style="background-color:#E693CB;color:#33332d"><a href="/#course-contents">Fullstack</a></div><div class="arrow__point " style="background-color:#E693CB;color:#33332d"></div></div><div class="arrow__wrapper"><div class="arrow__rectangle  " style="background-color:#E693CB;color:#33332d"><a href="/osa5">osa 5</a></div><div class="arrow__point " style="background-color:#E693CB;color:#33332d"></div></div><div class="arrow__wrapper"><div class="arrow__rectangle  " style="background-color:#33332d;color:white">React-sovellusten testaaminen</div><div class="arrow__point " style="background-color:#33332d;color:white"></div></div></div></div></div></div><div class="course "><div class="container element--flex element--relative"><div class="scroll-navigation col-2 spacing element--flex element--column" tag="ul"><a class="left-navigation-link" style="border-color:#E693CB" href="/osa5/kirjautuminen_frontendissa">a Kirjautuminen frontendissä</a><a class="left-navigation-link" style="border-color:#E693CB" href="/osa5/props_children_ja_proptypet">b props.children ja proptypet</a><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  " style="background-color:#E693CB;border-color:#E693CB">c React-sovellusten testaaminen</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div><a class="left-navigation-link" style="border-color:#E693CB" href="/osa5/custom_hookit">d Custom hookit</a></div><div class="course-content col-6 push-right-3 element--auto-bottom-margin"><p class="col-1 letter" style="border-color:#E693CB">c</p><h1 class="sub-header ">React-sovellusten testaaminen</h1></div></div><div class="container"><div class="course-content col-6 push-right-3">
<p>Reactilla tehtyjen frontendien testaamiseen on monia tapoja. Aloitetaan niihin tutustuminen nyt.</p>
<p>Testit tehdään samaan tapaan kuin edellisessä osassa eli Facebookin <a href="http://jestjs.io/">Jest</a>-kirjastolla. Jest onkin valmiiksi konfiguroitu create-react-app:illa luotuihin projekteihin.</p>
<p>Tarvitsemme Jestin lisäksi testaamiseen apukirjaston, jonka avulla React-komponentteja voidaan renderöidä testejä varten. Tähän tarkoitukseen ehdottomasti paras vaihtoehto vielä viime syksyyn asti oli AirBnB:n kehittämä <a href="https://github.com/airbnb/enzyme">enzyme</a>-kirjasto. Enzyme ei kuitenkaan tue kunnolla Reactin hookeja, joten käytämme Enzymen sijaan viime aikoina nopeasti suosiota kasvattanutta kirjastoa <a href="https://github.com/kentcdodds/react-testing-library">react-testing-library</a>. Jestin ilmaisuvoimaa kannattaa myös laajentaa kirjastolla <a href="https://www.npmjs.com/package/jest-dom">jest-dom</a>.</p>
<p>Asennetaan kirjastot komennolla:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev react<span class="token operator">-</span>testing<span class="token operator">-</span>library jest<span class="token operator">-</span>dom</code></pre></div>
<p>Testataan aluksi muistiinpanon renderöivää komponenttia:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">Note</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> note<span class="token punctuation">,</span> toggleImportance <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> label <span class="token operator">=</span> note<span class="token punctuation">.</span>important
    <span class="token operator">?</span> <span class="token string">&#x27;make not important&#x27;</span>
    <span class="token punctuation">:</span> <span class="token string">&#x27;make important&#x27;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token operator">&lt;</span>li className<span class="token operator">=</span><span class="token string">&#x27;note&#x27;</span><span class="token operator">&gt;</span></span>      <span class="token punctuation">{</span>note<span class="token punctuation">.</span>content<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>toggleImportance<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>label<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Huomaa, että muistiinpanon sisältävällä <i>li</i>-elementillä on <a href="https://reactjs.org/docs/dom-elements.html#classname">CSS</a>-luokka <i>note</i>, pääsemme sen avulla muistiinpanoon käsiksi testistä.</p>
<h3>Komponentin renderöinti testiä varten</h3>
<p>Tehdään testi tiedostoon <i>src/components/Note.test.js</i>, eli samaan hakemistoon, missä komponentti itsekin sijaitsee.</p>
<p>Ensimmäinen testi varmistaa, että komponentti renderöi muistiinpanon sisällön:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
<span class="token keyword">import</span> <span class="token string">&#x27;jest-dom/extend-expect&#x27;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> cleanup <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-testing-library&#x27;</span>
<span class="token keyword">import</span> Note <span class="token keyword">from</span> <span class="token string">&#x27;./Note&#x27;</span>

<span class="token function">afterEach</span><span class="token punctuation">(</span>cleanup<span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#x27;renders content&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> note <span class="token operator">=</span> <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> <span class="token string">&#x27;Komponenttitestaus tapahtuu react-testing-library:llä&#x27;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> component <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Note note<span class="token operator">=</span><span class="token punctuation">{</span>note<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span>
    <span class="token string">&#x27;Komponenttitestaus tapahtuu react-testing-library:llä&#x27;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Alun konfiguroinnin jälkeen testi renderöi komponentin metodin react-testing-library-kirjaston tarjoaman <a href="https://testing-library.com/docs/react-testing-library/api#render">render</a> avulla:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> component <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Note note<span class="token operator">=</span><span class="token punctuation">{</span>note<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span></code></pre></div>
<p>Normaalisti React-komponentit renderöityvät <i>DOM</i>:iin. Nyt kuitenkin renderöimme komponentteja testeille sopivaan muotoon laittamatta niitä DOM:iin. </p>
<p><em>render</em> palauttaa olion, jolla on useita kenttiä. Yksi kentistä on <i>container</i>, se sisältää koko komponentin renderöimän HTML:n.</p>
<p>Ekspektaatiossa varmistamme, että komponenttiin on renderöitynyt oikea teksti, eli muistiinpanon sisältö:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function">expect</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span>
  <span class="token string">&#x27;Komponenttitestaus tapahtuu react-testing-library:llä&#x27;</span>
<span class="token punctuation">)</span></code></pre></div>
<h3>Testien suorittaminen</h3>
<p>Create-react-app:issa on konfiguroitu testit oletusarvoisesti suoritettavaksi ns. watch-moodissa, eli jos suoritat testit komennolla <em>npm test</em>, jää konsoli odottamaan koodissa tapahtuvia muutoksia. Muutosten jälkeen testit suoritetaan automaattisesti ja Jest alkaa taas odottamaan uusia muutoksia koodiin.</p>
<p>Jos haluat ajaa testit &quot;normaalisti&quot;, se onnistuu komennolla</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token constant">CI</span><span class="token operator">=</span><span class="token boolean">true</span> npm test</code></pre></div>
<p><strong>HUOM:</strong> konsoli saattaa herjata virhettä, jos sinulla ei ole asennettuna watchmania. Watchman on Facebookin kehittämä tiedoston muutoksia tarkkaileva ohjelma. Ohjelma nopeuttaa testien ajoa ja ainakin osx sierrasta ylöspäin jatkuva testien vahtiminen aiheuttaa käyttäjillä virheilmoituksia. Näistä ilmoituksista pääsee eroon asentamalla Watchmanin.</p>
<p>Ohjeet ohjelman asentamiseen eri käyttöjärjestelmille löydät Watchmanin sivulta:
<a href="https://facebook.github.io/watchman/">https://facebook.github.io/watchman/</a></p>
<h3>Testien sijainti</h3>
<p>Reactissa on (ainakin) <a href="https://medium.com/@JeffLombardJr/organizing-tests-in-jest-17fc431ff850">kaksi erilaista</a> konventiota testien sijoittamiseen. Sijoitimme testit ehkä vallitsevan tavan mukaan, eli samaan hakemistoon missä testattava komponentti sijaitsee.</p>
<p>Toinen tapa olisi sijoittaa testit &quot;normaaliin&quot; tapaan omaan erilliseen hakemistoon. Valitaanpa kumpi tahansa tapa, on varmaa että se on jonkun mielestä täysin väärä.</p>
<p>Itse en pidä siitä, että testit ja normaali koodi ovat samassa hakemistossa. Noudatamme kuitenkin nyt tätä tapaa, sillä se on oletusarvo create-react-app:illa konfiguroiduissa sovelluksissa.</p>
<h3>Sisällön etsiminen testattavasta komponentista</h3>
<p>react-testing-library-kirjasto tarjoaa runsaasti tapoja, miten voimme tutkia testattavan komponentin sisältöä. Laajennetaan testiämme hiukan:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#x27;renders content&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> note <span class="token operator">=</span> <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> <span class="token string">&#x27;Komponenttitestaus tapahtuu react-testing-library:llä&#x27;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> component <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Note note<span class="token operator">=</span><span class="token punctuation">{</span>note<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>

  <span class="token comment">// tapa 1</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span>
    <span class="token string">&#x27;Komponenttitestaus tapahtuu react-testing-library:llä&#x27;</span>
  <span class="token punctuation">)</span>

  <span class="token comment">// tapa 2</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> component<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">&#x27;Komponenttitestaus tapahtuu react-testing-library:llä&#x27;</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeDefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// tapa 3</span>
  <span class="token keyword">const</span> div <span class="token operator">=</span> component<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;.note&#x27;</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span>
    <span class="token string">&#x27;Komponenttitestaus tapahtuu react-testing-library:llä&#x27;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Ensimmäinen tapa siis etsii tiettyä tekstiä koko komponentin renderöimästä HTML-koodista. </p>
<p>Toisena käytimme render-metodin palauttamaan olioon liitettyä <a href="https://testing-library.com/docs/api-queries#getbytext">getByText</a>-metodia, joka palauttaa sen elementin, jolla on määritelty teksti. Jos elementtiä ei ole, tapahtuu poikkeus. Eli mitään ekspektaatiota ei välttämättä edes tarvittaisi.</p>
<p>Kolmas tapa on etsiä komponentin sisältä tietty elementti metodilla <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector">querySelector</a>, joka saa parametrikseen <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors">CSS-selektorin</a>.</p>
<h3>Testien debuggaaminen</h3>
<p>Testejä tehdessä törmäämme tyypillisesti erittäin moniin ongelmiin. </p>
<p>Renderin palauttaman olion metodilla <a href="https://testing-library.com/docs/react-testing-library/api#debug">debug</a> voimme tulostaa komponentin tuottaman HTML:n konsoliin, eli kun muutamme testiä seuraavasti,</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#x27;renders content&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> note <span class="token operator">=</span> <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> <span class="token string">&#x27;Komponenttitestaus tapahtuu react-testing-library:llä&#x27;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> component <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Note note<span class="token operator">=</span><span class="token punctuation">{</span>note<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>

<span class="gatsby-highlight-code-line">  component<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>konsoliin tulostuu komponentin generoima HTML:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">console<span class="token punctuation">.</span>log node_modules<span class="token operator">/</span>react<span class="token operator">-</span>testing<span class="token operator">-</span>library<span class="token operator">/</span>dist<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token punctuation">:</span><span class="token number">64</span>
  <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>li
        <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;note&quot;</span>
      <span class="token operator">&gt;</span>
        Komponenttitestaus tapahtuu react<span class="token operator">-</span>testing<span class="token operator">-</span>library<span class="token punctuation">:</span>llä
        <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>
          make not important
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span></code></pre></div>
<p>On myös mahdollista etsiä komponentista pienempi osa, ja tulostaa sen HTML-koodi, tällöin tarvitsemme metodia <em>prettyDOM</em>, joka löytyy react-testing-library:n mukana tulevasta kirjastosta <i>dom-testing-library</i>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
<span class="token keyword">import</span> <span class="token string">&#x27;jest-dom/extend-expect&#x27;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> cleanup <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-testing-library&#x27;</span>
<span class="gatsby-highlight-code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> prettyDOM <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;dom-testing-library&#x27;</span></span><span class="token keyword">import</span> Note <span class="token keyword">from</span> <span class="token string">&#x27;./Note&#x27;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#x27;renders content&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> note <span class="token operator">=</span> <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> <span class="token string">&#x27;Komponenttitestaus tapahtuu react-testing-library:llä&#x27;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> component <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Note note<span class="token operator">=</span><span class="token punctuation">{</span>note<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">const</span> li <span class="token operator">=</span> component<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;li&#x27;</span><span class="token punctuation">)</span>
  
<span class="gatsby-highlight-code-line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">prettyDOM</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Eli haimme selektorin avulla komponentin sisältä <i>li</i>-elementin ja tulostimme sen HTML:n konsoliin:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">console<span class="token punctuation">.</span>log src<span class="token operator">/</span>components<span class="token operator">/</span>Note<span class="token punctuation">.</span>test<span class="token punctuation">.</span>js<span class="token punctuation">:</span><span class="token number">38</span>
  <span class="token operator">&lt;</span>li
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;note&quot;</span>
  <span class="token operator">&gt;</span>
    Komponenttitestaus tapahtuu react<span class="token operator">-</span>testing<span class="token operator">-</span>library<span class="token punctuation">:</span>llä
    <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>
      make not important
    <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></code></pre></div>
<h3>setup</h3>
<p>react-testing-library:n manuaali kehoittaa kutsumaan jokaisen testin jälkeen metodia
<a href="https://testing-library.com/docs/react-testing-library/api#cleanup">cleanup</a>. Hoidimme asian lisäämällä testitiedostoon <a href="https://jestjs.io/docs/en/setup-teardown">afterEach</a>-määreen, joka kutsuu metodia:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
<span class="gatsby-highlight-code-line"><span class="token keyword">import</span> <span class="token string">&#x27;jest-dom/extend-expect&#x27;</span></span><span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> cleanup <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-testing-library&#x27;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> prettyDOM <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;dom-testing-library&#x27;</span>
<span class="token keyword">import</span> Note <span class="token keyword">from</span> <span class="token string">&#x27;./Note&#x27;</span>

<span class="gatsby-highlight-code-line"><span class="token function">afterEach</span><span class="token punctuation">(</span>cleanup<span class="token punctuation">)</span></span></code></pre></div>
<p>Voisimme toistaa saman kaikkiin testitiedostoihin. Parempi vaihtoehto on kuitenkin <a href="https://testing-library.com/docs/react-testing-library/setup">konfiguroida</a> cleanup tapahtumaan automaattisesti. Tehdään konfiguraatiota varten tiedosto <i>src/setupTests.js</i> jolla on seuraava sisältö:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> <span class="token string">&#x27;jest-dom/extend-expect&#x27;</span>
<span class="token keyword">import</span> <span class="token string">&#x27;react-testing-library/cleanup-after-each&#x27;</span></code></pre></div>
<p>Nyt pääsemme eroon molemmista ylläolevan testikoodin korostetuista riveistä.</p>
<p><strong>HUOM</strong> mikäli testejä suoritettaessa ei löydetä tiedostossa <i>src/setupTests.js</i> tehtyjä konfiguraatioita, auttaa seuraavan asetuksen lisääminen tiedostoon package-lock.json:</p>
<div class="gatsby-highlight" data-language="text"><pre><code class="language-text">  &quot;jest&quot;: {
    ...
    &quot;setupFiles&quot;: [
      &quot;&lt;rootDir&gt;/src/setupTests.js&quot;
    ],
    ...
  }</code></pre></div>
<h3>Nappien painelu testeissä</h3>
<p>Sisällön näyttämisen lisäksi toinen <i>Note</i>-komponenttien vastuulla oleva asia on huolehtia siitä, että painettaessa noten yhteydessä olevaa nappia, tulee propsina välitettyä tapahtumankäsittelijäfunktiota <em>toggleImportance</em> kutsua.</p>
<p>Testaus onnistuu seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
<span class="gatsby-highlight-code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> fireEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-testing-library&#x27;</span></span><span class="token keyword">import</span> <span class="token punctuation">{</span> prettyDOM <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;dom-testing-library&#x27;</span> 
<span class="token keyword">import</span> Note <span class="token keyword">from</span> <span class="token string">&#x27;./Note&#x27;</span>

<span class="token comment">// ...</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;clicking the button calls event handler once&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> note <span class="token operator">=</span> <span class="token punctuation">{</span>
    content<span class="token punctuation">:</span> <span class="token string">&#x27;Komponenttitestaus tapahtuu jestillä ja enzymellä&#x27;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> mockHandler <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span> getByText <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Note note<span class="token operator">=</span><span class="token punctuation">{</span>note<span class="token punctuation">}</span> toggleImportance<span class="token operator">=</span><span class="token punctuation">{</span>mockHandler<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> button <span class="token operator">=</span> <span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">&#x27;make not important&#x27;</span><span class="token punctuation">)</span>
  fireEvent<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>mockHandler<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Testissä on muutama mielenkiintoinen seikka. Tapahtumankäsittelijäksi annetaan Jestin avulla määritelty <a href="https://facebook.github.io/jest/docs/en/mock-functions.html">mock</a>-funktio:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> mockHandler <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p>Testi hakee renderöidystä komponentista napin <i>tekstin perusteella</i> ja klikkaa sitä:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> button <span class="token operator">=</span> <span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">&#x27;make not important&#x27;</span><span class="token punctuation">)</span>
fireEvent<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span></code></pre></div>
<p>Klikkaaminen tapahtuu metodin <a href="https://testing-library.com/docs/api-events#fireevent">fireEvent</a> avulla.</p>
<p>Testin ekspektaatio varmistaa, että <i>mock-funktiota</i> on kutsuttu täsmälleen kerran:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function">expect</span><span class="token punctuation">(</span>mockHandler<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></code></pre></div>
<p><a href="https://en.wikipedia.org/wiki/Mock_object">Mockoliot ja -funktiot</a> ovat testauksessa yleisesti käytettyjä valekomponentteja, joiden avulla korvataan testattavien komponenttien riippuvuuksia, eli niiden tarvitsemia muita komponentteja. Mockit mahdollistavat mm. kovakoodattujen syötteiden palauttamisen sekä niiden metodikutsujen lukumäärän sekä parametrien testauksen aikaisen tarkkailun.</p>
<p>Esimerkissämme mock-funktio sopi tarkoitukseen erinomaisesti, sillä sen avulla on helppo varmistaa, että metodia on kutsuttu täsmälleen kerran.</p>
<h3>Komponentin <i>Togglable</i> testit</h3>
<p>Tehdään komponentille <i>Togglable</i> muutama testi. Lisätään komponentin lapset renderöivään div-elementtiin CSS-luokka <i>togglableContent</i>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> Togglable <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> ref<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span>hideWhenVisible<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>toggleVisibility<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>props<span class="token punctuation">.</span>buttonLabel<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="gatsby-highlight-code-line">      <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span>showWhenVisible<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;togglableContent&quot;</span><span class="token operator">&gt;</span></span>        <span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>toggleVisibility<span class="token punctuation">}</span><span class="token operator">&gt;</span>cancel<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Testit ovat seuraavassa</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> fireEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-testing-library&#x27;</span>
<span class="token keyword">import</span> Togglable <span class="token keyword">from</span> <span class="token string">&#x27;./Togglable&#x27;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#x27;&lt;Togglable /&gt;&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> component

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    component <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Togglable buttonLabel<span class="token operator">=</span><span class="token string">&quot;show...&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;testDiv&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Togglable<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;renders its children&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    component<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;.testDiv&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;at start the children are not displayed&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> div <span class="token operator">=</span> component<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;.togglableContent&#x27;</span><span class="token punctuation">)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveStyle</span><span class="token punctuation">(</span><span class="token string">&#x27;display: none&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;after clicking the button, children are displayed&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> button <span class="token operator">=</span> component<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">&#x27;show...&#x27;</span><span class="token punctuation">)</span>
    fireEvent<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span>

    <span class="token keyword">const</span> div <span class="token operator">=</span> component<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;.togglableContent&#x27;</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toHaveStyle</span><span class="token punctuation">(</span><span class="token string">&#x27;display: none&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Ennen jokaista testiä suoritettava <em>beforeEach</em> renderöi <i>Togglable</i>-komponentin muuttujaan <em>component</em>.</p>
<p>Ensimmäinen testi tarkastaa, että <i>Togglable</i> renderöi sen lapsikomponentin <code class="language-text">&lt;div className=&quot;testDiv&quot; /&gt;</code>. </p>
<p>Loput testit varmistavat metodia <a href="https://www.npmjs.com/package/jest-dom#tohavestyle">toHaveStyle</a> käyttäen, että Togglablen sisältämä lapsikomponentti on alussa näkymättömissä, eli sen sisältävään <i>div</i>-elementtiin liittyy tyyli <code class="language-text">{ display: &#x27;none&#x27; }</code>, ja että nappia painettaessa komponentti näkyy, eli näkymättömäksi tekevää tyyliä <i>ei</i> enää ole. </p>
<p>Nappi etsitään jälleen nappiin liittyvän tekstin perusteella. Nappi oltaisiin voitu etsiä myös CSS-selektorin avulla</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> button <span class="token operator">=</span> component<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;button&#x27;</span><span class="token punctuation">)</span></code></pre></div>
<p>Komponentissa on kaksi nappia, mutta koska <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector">querySelector</a> palauttaa <i>ensimmäisen</i> löytyvän napin, löytyy napeista oikea.</p>
<p>Lisätään vielä mukaan testi, joka varmistaa että auki togglattu sisältö saadaan piilotettua painamalla komponentin toisena olevaa nappia</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;toggled content can be closed&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> button <span class="token operator">=</span> component<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;button&#x27;</span><span class="token punctuation">)</span>
  fireEvent<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span>

  <span class="token keyword">const</span> closeButton <span class="token operator">=</span> component<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;button:nth-child(2)&#x27;</span><span class="token punctuation">)</span>
  fireEvent<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>closeButton<span class="token punctuation">)</span>

  <span class="token keyword">const</span> div <span class="token operator">=</span> component<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;.togglableContent&#x27;</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveStyle</span><span class="token punctuation">(</span><span class="token string">&#x27;display: none&#x27;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>eli määrittelimme selektorin, joka palauttaa toisena olevan napin <code class="language-text">button:nth-child(2)</code>. Testeissä ei kuitenkaan ole viisasta olla riippuvainen komponentin nappien järjestyksestä, joten parempi onkin hakea napit niiden tekstin perusteella:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;toggled content can be closed&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> button <span class="token operator">=</span> component<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">&#x27;show...&#x27;</span><span class="token punctuation">)</span>
  fireEvent<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span>

  <span class="token keyword">const</span> closeButton <span class="token operator">=</span> component<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">&#x27;cancel&#x27;</span><span class="token punctuation">)</span>
  fireEvent<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>closeButton<span class="token punctuation">)</span>

  <span class="token keyword">const</span> div <span class="token operator">=</span> component<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;.togglableContent&#x27;</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveStyle</span><span class="token punctuation">(</span><span class="token string">&#x27;display: none&#x27;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Käyttämämme <em>getByText</em> on vain yksi monista <a href="https://testing-library.com/docs/api-queries#queries">queryistä</a>, joita <i>react-testing-library</i> tarjoaa.</p>
<p>Sovelluksen tämänhetkinen koodi on kokonaisuudessaan <a href="https://github.com/fullstack-hy2019/part2-notes/tree/part5-7">githubissa</a>, branchissa <i>part5-7</i>.</p>
</div></div>
<div class="banner spacing spacing--after tasks" style="background-color:#E693CB"><div class="container"><div class="course-content col-6 push-right-3" style="border-color:#E693CB;background-color:transparent">
<h3>Tehtäviä</h3>
<h4>5.13: blogilistan testit, step1</h4>
<p>Lisää sovellukseesi tilapäisesti seuraava komponentti</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>

<span class="token keyword">const</span> <span class="token function-variable function">SimpleBlog</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> blog<span class="token punctuation">,</span> onClick <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>blog<span class="token punctuation">.</span>title<span class="token punctuation">}</span> <span class="token punctuation">{</span>blog<span class="token punctuation">.</span>author<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      blog has <span class="token punctuation">{</span>blog<span class="token punctuation">.</span>likes<span class="token punctuation">}</span> likes
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>like<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> SimpleBlog</code></pre></div>
<p>Tee testi, joka varmistaa, että komponentti renderöi blogin titlen, authorin ja likejen määrän.</p>
<p>Lisää komponenttiin tarvittaessa testausta helpottavia CSS-luokkia.</p>
<h4>5.14: blogilistan testit, step2</h4>
<p>Tee testi, joka varmistaa, että jos komponentin <i>like</i>-nappia painetaan kahdesti, komponentin propsina saamaa tapahtumankäsittelijäfunktiota kutsutaan kaksi kertaa.</p>
<h4>5.15*: blogilistan testit, step3</h4>
<p>Tee oman sovelluksesi komponentille <i>Blog</i> testit, jotka varmistavat, että oletusarvoisesti blogista on näkyvissä ainoastaan nimi ja kirjoittaja, ja että klikkaamalla niitä saadaan näkyviin myös muut osat blogin tiedoista.</p>
</div></div></div>
<div class="container"><div class="course-content col-6 push-right-3">
<h3>Lomakkeiden testaus</h3>
<p>Käytimme jo edellisissä testeissä <a href="https://testing-library.com/docs/api-events#fireevent">fireEvent</a>-funktiota nappien klikkaamiseen:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> button <span class="token operator">=</span> component<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">&#x27;show...&#x27;</span><span class="token punctuation">)</span>
fireEvent<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span></code></pre></div>
<p>Käytännössä siis loimme <i>fireEventin</i> avulla tapahtuman <i>click</i> nappia vastaavalle komponentille. Voimme myös simuloida lomakkeisiin kirjoittamista <i>fireEventin</i> avulla.</p>
<p>Tehdään testi komponentille <i>NoteForm</i>. Lomakkeen koodi näyttää seuraavalta</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">NoteForm</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> onSubmit<span class="token punctuation">,</span> handleChange<span class="token punctuation">,</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Luo uusi muistiinpano<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>onSubmit<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span><span class="token operator">&gt;</span>tallenna<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Lomakkeen toimintaperiaatteena on synkronoida syötekentän tila sen ulkopuolella olevan React-komponentin tilaan. Lomakettamme on jossain määrin vaikea testata yksistään.</p>
<p>Teemmekin testejä varten apukomponentin <i>Wrapper</i>, joka renderöi <i>NoteForm</i>:in ja hallitsee lomakkeen tilaa parametrinaan saamansa propsin <i>state</i> avulla:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">Wrapper</span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    props<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>NoteForm
      value<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">}</span>
      onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>onSubmit<span class="token punctuation">}</span>
      handleChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span> </code></pre></div>
<p>Testi on seuraavassa:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> fireEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-testing-library&#x27;</span>
<span class="token keyword">import</span> NoteForm <span class="token keyword">from</span> <span class="token string">&#x27;./NoteForm&#x27;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Wrapper</span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#x27;&lt;NoteForm /&gt; updates parent state and calls onSubmit&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onSubmit <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> component <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Wrapper onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>onSubmit<span class="token punctuation">}</span> state<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> input <span class="token operator">=</span> component<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;input&#x27;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> form <span class="token operator">=</span> component<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;form&#x27;</span><span class="token punctuation">)</span>

  fireEvent<span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token punctuation">{</span> target<span class="token punctuation">:</span> <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token string">&#x27;lomakkeiden testaus on hankalaa&#x27;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  fireEvent<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>onSubmit<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#x27;lomakkeiden testaus on hankalaa&#x27;</span><span class="token punctuation">)</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Testi luo <i>Wrapper</i>-komponentin, jolle se välittää propseina mockatun funktion <em>onSubmit</em> sekä tilaa edustavan olion <i>state</i>.</p>
<p>Wrapper välittää funktion edelleen <i>NoteFormille</i> tapahtuman <i>onSubmit</i> käsittelijäksi ja saamansa propsin <i>state</i> kentän <i>value</i> syötekentän <i>input</i> arvoksi. </p>
<p>Syötekenttään <i>input</i> kirjoittamista simuloidaan tekemällä syötekenttään tapahtuma <i>change</i> ja määrittelemällä sopiva olio, joka määrittelee syötekenttään &#x27;kirjoitetun&#x27; sisällön.</p>
<p>Lomake lähetetään simuloimalla tapahtuma <i>submit</i> lomakkeelle.</p>
<p>Testin ensimmäinen ekspektaatio varmistaa, että lomakkeen lähetys on aikaansaanut tapahtumankäsittelijän kutsumisen. Toinen ekspektaatio tutkii komponentille <i>Wrapper</i> propsina välitettyä muuttujaa <i>state</i>, ja varmistaa, että lomakkeelle kirjoitettu teksti on siirtynyt tilaan. </p>
<h3>Frontendin integraatiotestaus</h3>
<p>Suoritimme edellisessä osassa backendille integraatiotestejä, jotka testasivat backendin tarjoaman API:n läpi backendia ja tietokantaa. Backendin testauksessa tehtiin tietoinen päätös olla kirjoittamatta yksikkötestejä sillä backendin koodi on melko suoraviivaista ja ongelmat tulevatkin esiin todennäköisemmin juuri monimutkaisemmissa skenaarioissa, joita integraatiotestit testaavat hyvin.</p>
<p>Toistaiseksi kaikki frontendiin tekemämme testit ovat olleet yksittäisten komponenttien oikeellisuutta valvovia yksikkötestejä. Yksikkötestaus on toki välillä hyödyllistä, mutta kattavinkaan yksikkötestaus ei riitä antamaan riittävää luotettavuutta sille, että järjestelmä toimii kokonaisuudessaan.</p>
<p>Tehdään nyt sovellukselle yksi integraatiotesti. Integraatiotestaus on huomattavasti komponenttien yksikkötestausta hankalampaa. Erityisesti sovelluksemme kohdalla ongelmia aiheuttaa kaksi seikkaa: sovellus hakee näytettävät muistiinpanot palvelimelta <i>ja</i> sovellus käyttää local storagea kirjautuneen käyttäjän tietojen tallettamiseen.</p>
<p>Local storage ei ole oletusarvoiseti käytettävissä testejä suorittaessa, sillä kyseessä on selaimen tarjoama toiminnallisuus ja testit ajetaan selaimen ulkopuolella. Ongelma on helppo korjata määrittelemällä testien suorituksen ajaksi <i>mock</i> joka matkii local storagea. Tapoja tähän on <a href="https://stackoverflow.com/questions/32911630/how-do-i-deal-with-localstorage-in-jest-tests">monia</a>.</p>
<p>Koska testimme ei edellytä local storagelta juuri mitään toiminnallisuutta, teemme tiedostoon <a href="https://github.com/facebookincubator/create-react-app/blob/ed5c48c81b2139b4414810e1efe917e04c96ee8d/packages/react-scripts/template/README.md#initializing-test-environment">src/setupTests.js</a> hyvin yksinkertaisen mockin</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">let</span> savedItems <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> localStorageMock <span class="token operator">=</span> <span class="token punctuation">{</span>
  setItem<span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    savedItems<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> item
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  getItem<span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> savedItems<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>
  clear<span class="token punctuation">:</span> savedItems <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span>localStorage <span class="token operator">=</span> localStorageMock</code></pre></div>
<p>Toinen ongelmistamme on se, että sovellus hakee näytettävät muistiinpanot palvelimelta. Muistiinpanojen haku tapahtuu heti komponentin <i>App</i> luomisen jälkeen suoritettavassa effect hookissa:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    noteService
      <span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>initialNotes <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setNotes</span><span class="token punctuation">(</span>initialNotes<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Jestin <a href="https://facebook.github.io/jest/docs/en/manual-mocks.html#content">manual mock</a> -konsepti tarjoaa tilanteeseen hyvän ratkaisun. Manual mockien avulla voidaan kokonainen moduuli, tässä tapauksessa <em>noteService</em> korvata testien ajaksi vaihtoehtoisella esim. kovakoodattua dataa tarjoavalla toiminnallisuudella.</p>
<p>Luodaan Jestin ohjeiden mukaisesti hakemistoon <i>src/services</i> alihakemisto <i>__mocks__</i> (alussa ja lopussa kaksi alaviivaa) ja sinne tiedosto <i>notes.js</i> jonka määrittelemä metodi <i>getAll</i> palauttaa kovakoodatun listan muistiinpanoja:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> notes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">&quot;5a451df7571c224a31b5c8ce&quot;</span><span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> <span class="token string">&quot;HTML on helppoa&quot;</span><span class="token punctuation">,</span>
    date<span class="token punctuation">:</span> <span class="token string">&quot;2019-01-28T16:38:15.541Z&quot;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    user<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      _id<span class="token punctuation">:</span> <span class="token string">&quot;5a437a9e514ab7f168ddf138&quot;</span><span class="token punctuation">,</span>
      username<span class="token punctuation">:</span> <span class="token string">&quot;mluukkai&quot;</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">&quot;Matti Luukkainen&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">&quot;5a451e21e0b8b04a45638211&quot;</span><span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> <span class="token string">&quot;Selain pystyy suorittamaan vain javascriptiä&quot;</span><span class="token punctuation">,</span>
    date<span class="token punctuation">:</span> <span class="token string">&quot;2019-01-28T16:38:57.694Z&quot;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    user<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      _id<span class="token punctuation">:</span> <span class="token string">&quot;5a437a9e514ab7f168ddf138&quot;</span><span class="token punctuation">,</span>
      username<span class="token punctuation">:</span> <span class="token string">&quot;mluukkai&quot;</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">&quot;Matti Luukkainen&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">&quot;5a451e30b5ffd44a58fa79ab&quot;</span><span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> <span class="token string">&quot;HTTP-protokollan tärkeimmät metodit ovat GET ja POST&quot;</span><span class="token punctuation">,</span>
    date<span class="token punctuation">:</span> <span class="token string">&quot;2019-01-28T16:39:12.713Z&quot;</span><span class="token punctuation">,</span>
    important<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    user<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      _id<span class="token punctuation">:</span> <span class="token string">&quot;5a437a9e514ab7f168ddf138&quot;</span><span class="token punctuation">,</span>
      username<span class="token punctuation">:</span> <span class="token string">&quot;mluukkai&quot;</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">&quot;Matti Luukkainen&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> <span class="token function-variable function">getAll</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>notes<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> getAll <span class="token punctuation">}</span></code></pre></div>
<p>Määritelty metodi <em>getAll</em> palauttaa muistiinpanojen listan käärittynä promiseksi metodin <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/resolve">Promise.resolve</a> avulla sillä käytettäessä metodia, oletetaan sen paluuarvon olevan promise:</p>
<p>Olemme valmiina määrittelemään testin. Koska kyseessä on koko sovellusta koskeva testi, tehdään se tiedostoon <i>App.test.js</i>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span>  waitForElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-testing-library&#x27;</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&#x27;./services/notes&#x27;</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#x27;./App&#x27;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#x27;&lt;App /&gt;&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;renders all notes it gets from backend&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> component <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
    component<span class="token punctuation">.</span><span class="token function">rerender</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">waitForElement</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> component<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;.note&#x27;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">const</span> notes <span class="token operator">=</span> component<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&#x27;.note&#x27;</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>notes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> 

    <span class="token function">expect</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span>
      <span class="token string">&#x27;HTML on helppoa&#x27;</span>
    <span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span>
      <span class="token string">&#x27;Selain pystyy suorittamaan vain javascriptiä&#x27;</span>
    <span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveTextContent</span><span class="token punctuation">(</span>
      <span class="token string">&#x27;HTTP-protokollan tärkeimmät metodit ovat GET ja POST&#x27;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Komennolla <i>jest.mock(&#x27;./services/notes&#x27;)</i> otetaan juuri määritelty mock käyttöön. Loogisempi paikka komennolle olisi kenties testien määrittelyt tekevä tiedosto <i>src/setupTests.js</i>.</p>
<p>Testi aloittaa renderöimällä komponentin uudelleen <code class="language-text">component.rerender(&lt;App /&gt;)</code>, näin varmistetaan että kaikki efektit suoritetaan. Voi kyllä olla, että komento ei ole enää tarpeen uusimpien Reactin versioiden kanssa.</p>
<p>Koska efektin käynnistämä muistiinpanojen haku palvelimelta on <a href="https://testing-library.com/docs/api-async">asynkroninen</a> tapahtuma, varmistamme funktion <a href="https://testing-library.com/docs/api-async#waitforelement">waitForElement</a> avulla, että <i>App</i> ehtii renderöidä muistiinpanot</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">await</span> <span class="token function">waitForElement</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> component<span class="token punctuation">.</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;.note&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>Tämän jälkeen teemme varsinaiset expektaatiot, eli varmistetaan että sovelluksessa on kolme CSS-luokalla <i>note</i> merkittyä elementtiä, ja että kaikkien muistiinpanojen sisältö on renderöity.</p>
<h3>Testauskattavuus</h3>
<p><a href="https://github.com/facebookincubator/create-react-app/blob/ed5c48c81b2139b4414810e1efe917e04c96ee8d/packages/react-scripts/template/README.md#coverage-reporting">Testauskattavuus</a> saadaan helposti selville suorittamalla testit komennolla</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token constant">CI</span><span class="token operator">=</span><span class="token boolean">true</span> npm test <span class="token operator">--</span> <span class="token operator">--</span>coverage</code></pre></div>
<picture><img style="border-color:#E693CB" alt="fullstack content" src="/static/2e96da75d2421a20b6089cf703dffb1f/14be6/18.png"/></picture>
<p>Melko primitiivinen HTML-muotoinen raportti generoituu hakemistoon <i>coverage/lcov-report</i>. HTML-muotoinen raportti kertoo mm. yksittäisen komponenttien testaamattomat koodirivit:</p>
<picture><img style="border-color:#E693CB" alt="fullstack content" src="/static/e7da7658330ccb1f1ad8b95e713b2e73/14be6/19.png"/></picture>
<p>Huomaamme, että parannettavaa jäi vielä runsaasti.</p>
<p>Sovelluksen tämänhetkinen koodi on kokonaisuudessaan <a href="https://github.com/fullstack-hy2019/part2-notes/tree/part5-8">githubissa</a>, branchissa <i>part5-8</i>.</p>
</div></div>
<div class="banner spacing spacing--after tasks" style="background-color:#E693CB"><div class="container"><div class="course-content col-6 push-right-3" style="border-color:#E693CB;background-color:transparent">
<h3>Tehtäviä</h3>
<h4>5.16*: blogilistan testit, step4</h4>
<p>Tee sovelluksesi integraatiotesti, joka varmistaa, että jos käyttäjä ei ole kirjautunut järjestelmään, näyttää sovellus ainoastaan kirjautumislomakkeen, eli yhtään blogia ei vielä renderöidä.</p>
<p>Testi voi odottaa komponentin sisällön renderöitymistä funktiolla <em>waitForElement</em></p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> 
  render<span class="token punctuation">,</span> waitForElement 
<span class="gatsby-highlight-code-line"><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-testing-library&#x27;</span></span>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&#x27;./services/blogs&#x27;</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#x27;./App&#x27;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#x27;&lt;App /&gt;&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;if no user logged, notes are not rendered&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> component <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
    component<span class="token punctuation">.</span><span class="token function">rerender</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>

<span class="gatsby-highlight-code-line">    <span class="token keyword">await</span> <span class="token function">waitForElement</span><span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> component<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">&#x27;kirjaudu&#x27;</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">)</span> </span>
    <span class="token comment">// expectations here</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p><strong>VAROITUS</strong> kun tein tehtävää, esiintyi testeissä ajoittain epästabiiliutta sen suhteen, toimiko <em>waitForElement</em> tai joku sitä vastaavista asynkronisten operaatioiden odottamiseen tarkoitetuista metodeista.</p>
<h4>5.17*: blogilistan testit, step5</h4>
<p>Tee myös testi, joka varmistaa, että kun käyttäjä on kirjautuneena, blogit renderöityvät sivulle.</p>
<p><strong>Vihje:</strong></p>
<p>Kirjautuminen kannattaa toteuttaa manipuloimalla testeissä local storagea. Jos määrittelet testeille mock-localstoragen ylläolevaa materiaalia seuraten, voit käyttää testikoodissa local storagea seuraavasti:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  username<span class="token punctuation">:</span> <span class="token string">&#x27;tester&#x27;</span><span class="token punctuation">,</span>
  token<span class="token punctuation">:</span> <span class="token string">&#x27;1231231214&#x27;</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">&#x27;Teuvo Testaaja&#x27;</span>
<span class="token punctuation">}</span>

localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#x27;loggedBlogAppUser&#x27;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
</div></div></div>
<div class="container"><div class="course-content col-6 push-right-3">
<h3>Snapshot-testaus</h3>
<p>Jest tarjoaa &quot;perinteisen&quot; testaustavan lisäksi aivan uudenlaisen tavan testaukseen, ns. <a href="https://facebook.github.io/jest/docs/en/snapshot-testing.html">snapshot</a>-testauksen. Mielenkiintoista snapshot-testauksessa on se, että sovelluskehittäjän ei tarvitse itse määritellä ollenkaan testejä, snapshot-testauksen käyttöönotto riittää.</p>
<p>Periaatteena on verrata komponenttien määrittelemää HTML:ää aina koodin muutoksen jälkeen siihen, minkälaisen HTML:n komponentit määrittelivät ennen muutosta.</p>
<p>Jos snapshot-testi huomaa muutoksen komponenttien määrittelemässä HTML:ssä, voi kyseessä joko olla haluttu muutos tai vahingossa aiheutettu &quot;bugi&quot;. Snapshot-testi huomauttaa sovelluskehittäjälle, jos komponentin määrittelemä HTML muuttuu. Sovelluskehittäjä kertoo muutosten yhteydessä, oliko muutos haluttu. Jos muutos tuli yllätyksenä, eli kyseessä oli bugi, sovelluskehittäjä huomaa sen snapshot-testauksen ansiosta nopeasti.</p>
<h3>End to end -testaus</h3>
<p>Olemme tehneet sekä backendille että frontendille hieman niitä kokonaisuutena testaavia integraatiotestejä. Eräs tärkeä testauksen kategoria on vielä käsittelemättä, <a href="https://en.wikipedia.org/wiki/System_testing">järjestelmää kokonaisuutena</a> testaavat &quot;end to end&quot; (eli E2E) -testit.</p>
<p>Web-sovellusten E2E-testaus tapahtuu simuloidun selaimen avulla esimerkiksi <a href="http://www.seleniumhq.org">Selenium</a>-kirjastoa käyttäen. Toinen vaihtoehto on käyttää ns. <a href="https://en.wikipedia.org/wiki/Headless_browser">headless browseria</a> eli selainta, jolla ei ole ollenkaan graafista käyttöliittymää. Esim. Chromea on mahdollista suorittaa Headless-moodissa.</p>
<p>E2E testit ovat potentiaalisesti kaikkein hyödyllisin testikategoria, sillä ne tutkivat järjestelmää saman rajapinnan kautta kuin todelliset käyttäjät.</p>
<p>E2E-testeihin liittyy myös ikäviä puolia. Niiden konfigurointi on haastavampaa kuin yksikkö- ja integraatiotestien. E2E-testit ovat tyypillisesti myös melko hitaita ja isommassa ohjelmistossa niiden suoritusaika voi helposti nousta minuutteihin, tai jopa tunteihin. Tämä on ikävää sovelluskehityksen kannalta, sillä sovellusta koodatessa on erittäin hyödyllistä pystyä ajamaan testejä mahdollisimman usein koodin regressioiden varalta.</p>
<p>Palaamme end to end -testeihin kurssin viimeisessä, eli seitsemännessä osassa.</p>
</div></div></div><div class="container spacing element--flex element--centered"><a class="edit-link" target="__BLANK" href="https://github.com/fullstack-hy2019/fullstack-hy2019.github.io/edit/source/src/content/osa5/osa5c.md">Ehdota muutosta materiaalin sisältöön</a></div><div class="container spacing spacing--after-large prev-next__container "><a class="col-4--mobile push-right-1 prev" href="/osa5/props_children_ja_proptypet"><div class=" element--flex element--column"><p>Osa <!-- -->5b</p><b>Edellinen osa</b></div></a><div class="col-1--mobile separator"></div><a class="col-4--mobile push-left-1 next" href="/osa5/custom_hookit"><div class=" element--flex element--column"><p>Osa <!-- -->5d</p><b>Seuraava osa</b></div></a></div></div><div class="container spacing--after-small spacing--mobile element--flex" id="footer"><div class="col-5 col-10--mobile order-2--mobile footer__links element--flex element--space-between"><a href="https://www.helsinki.fi/" class="col-5 col-4--mobile spacing--mobile"><div class="image col-6 image--contain"><div class="image__container"><img style="background-color:;background-opacity:0.5" class="image__content" src="/static/hgin_yliopisto-30c68104749d830b6cef6ea8c6339b16.png" alt="Helsingin yliopiston logo"/></div></div></a><a href="https://www.houston-inc.com/" class="col-5 col-4--mobile spacing--mobile"><div class="image col-6 image--contain"><div class="image__container"><img style="background-color:;background-opacity:0.5" class="image__content" src="/static/houston_logo-356bd2a9a75b44bdf7897b2cdd387600.png" alt="Houston inc. logo"/></div></div></a></div><div class="col-5 col-5--mobile order-1--mobile footer__navigation element--flex"><a class="footer__navigation-link nav-item-hover col-10--mobile" style="margin-left:4.5rem" href="/about">KURSSISTA</a><a class="footer__navigation-link nav-item-hover col-10--mobile" style="margin-left:4.5rem" href="/#course-contents">KURSSIN SISÄLTÖ</a><a class="footer__navigation-link nav-item-hover col-10--mobile" style="margin-left:4.5rem" href="/faq">FAQ</a></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-content-template-js","jsonName":"osa-5-react-sovellusten-testaaminen-108","path":"/osa5/react_sovellusten_testaaminen"};window.dataPath="407/path---osa-5-react-sovellusten-testaaminen-108-c64-dKr5C2ZkAS7uKQvJA4dmB25Wbkg";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.f588656cc80a065e5f1e.css","/app-2c491ec1dd58eba53a73.js"],"component---src-templates-part-intro-template-js":["/component---src-templates-part-intro-template-js.f89e77c0788c3b42eb99.css","/component---src-templates-part-intro-template-js-99c3379e0c85f98af85b.js"],"component---src-templates-content-template-js":["/component---src-templates-content-template-js.59a575ad88fdbaeba17d.css","/component---src-templates-content-template-js-45199be9da0474ef210f.js"],"component---src-pages-404-js":["/component---src-pages-404-js.8d4a7977feb76fc76984.css","/component---src-pages-404-js-64d6fadd34eefb01c89d.js"],"component---src-pages-about-js":["/component---src-pages-about-js.9b307033bd4c3b127e05.css","/component---src-pages-about-js-a7c778ddcc1511459dd0.js"],"component---src-pages-companies-js":["/component---src-pages-companies-js.150fce7cfbe4cb867585.css","/component---src-pages-companies-js-0c6d541d51f8a8346648.js"],"component---src-pages-faq-js":["/component---src-pages-faq-js.97fa9f467f8483b003af.css","/component---src-pages-faq-js-92a071fe192efb45748d.js"],"component---src-pages-index-js":["/component---src-pages-index-js.54fb40b9e036e2b0b9a4.css","/component---src-pages-index-js-5f7f244c9eb69602ec9a.js"]};/*]]>*/</script><script src="/webpack-runtime-4c016d368e8717b20ee1.js" async=""></script><script src="/3-581fe0821230e9175114.js" async=""></script><script src="/0-87340ba4bd0a15678a60.js" async=""></script><script src="/2-8cb475ac5ceeb60d8393.js" async=""></script><script src="/component---src-templates-content-template-js-45199be9da0474ef210f.js" async=""></script><script src="/1-072e5cd30afe3d25b43a.js" async=""></script><script src="/app-2c491ec1dd58eba53a73.js" async=""></script></body></html>