{"data":{"markdownRemark":{"html":"<div class=\"content\">\n<h2>Kirjautumislomakkeen näyttäminen vain tarvittaessa</h2>\n<p>Muutetaan sovellusta siten, että kirjautumislomaketta ei oletusarvoisesti näytetä:</p>\n<picture><img src=\"/static/d80281d9b4145460638bd90d693d1a8a/14be6/3.png\" srcset=\"/static/d80281d9b4145460638bd90d693d1a8a/4cce7/3.png 200w,\n/static/d80281d9b4145460638bd90d693d1a8a/bae5f/3.png 400w,\n/static/d80281d9b4145460638bd90d693d1a8a/14be6/3.png 800w,\n/static/d80281d9b4145460638bd90d693d1a8a/1b35a/3.png 1200w,\n/static/d80281d9b4145460638bd90d693d1a8a/9ee03/3.png 1600w,\n/static/d80281d9b4145460638bd90d693d1a8a/00da9/3.png 1672w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Lomake aukeaa, jos käyttäjä painaa nappia <em>login</em>:</p>\n<picture><img src=\"/static/965f241a142c0bc26a29df36c0b7ecc7/14be6/4.png\" srcset=\"/static/965f241a142c0bc26a29df36c0b7ecc7/4cce7/4.png 200w,\n/static/965f241a142c0bc26a29df36c0b7ecc7/bae5f/4.png 400w,\n/static/965f241a142c0bc26a29df36c0b7ecc7/14be6/4.png 800w,\n/static/965f241a142c0bc26a29df36c0b7ecc7/1b35a/4.png 1200w,\n/static/965f241a142c0bc26a29df36c0b7ecc7/c6ea5/4.png 1506w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Napilla <em>cancel</em> käyttäjä saa tarvittaessa suljettua lomakkeen.</p>\n<p>Aloitetaan eristämällä kirjautumislomake omaksi komponentikseen:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">const LoginForm = ({ handleSubmit, handleChange, username, password }) => {\nreturn (\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Kirjaudu<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">onSubmit</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{handleSubmit}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n      käyttäjätunnus\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{username}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">onChange</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{handleChange}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n      salasana\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span>\n        <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{password}<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">onChange</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{handleChange}<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>kirjaudu<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n) }</code></pre></div>\n<p>Reactin <a href=\"https://reactjs.org/docs/lifting-state-up.html\">suosittelemaan tyyliin</a> tila ja tilaa käsittelevät funktiot on kaikki määritelty komponentin ulkopuolella ja välitetään komponentille propseina.</p>\n<p>Huomaa, että propsit otetaan vastaan <em>destrukturoimalla</em>, eli sen sijaan että määriteltäisiin</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">const LoginForm = (props) => {\n  return (\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">onSubmit</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{props.handleSubmit}</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n          käyttäjätunnus\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span>\n            <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{props.username}</span>\n            <span class=\"token attr-name\">onChange</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{props.handleChange}</span>\n            <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n        // ...\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>kirjaudu<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  )\n}</code></pre></div>\n<p>jolloin muuttujan <em>props</em> kenttiin on viitattava muuttujan kautta esim. <em>props.handleSubmit</em>, otetaan kentät suoraan vastaan omiin muuttujiinsa.</p>\n<p>Nopea tapa toiminnallisuuden toteuttamiseen on muuttaa komponentin <em>App</em> käyttämä funktio <em>loginForm</em> seuraavaan muotoon:</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">const loginForm = () =&gt; {\n  const hideWhenVisible = { display: this.state.loginVisible ? &#39;none&#39; : &#39;&#39; }\n  const showWhenVisible = { display: this.state.loginVisible ? &#39;&#39; : &#39;none&#39; }\n\n  return (\n    &lt;div&gt;\n      &lt;div style={hideWhenVisible}&gt;\n        &lt;button onClick={e =&gt; this.setState({ loginVisible: true })}&gt;log in&lt;/button&gt;\n      &lt;/div&gt;\n      &lt;div style={showWhenVisible}&gt;\n        &lt;LoginForm\n          username={this.state.username}\n          password={this.state.password}\n          handleChange={this.handleLoginFieldChange}\n          handleSubmit={this.login}\n        /&gt;\n        &lt;button onClick={e =&gt; this.setState({ loginVisible: false })}&gt;cancel&lt;/button&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  )\n}</code></pre></div>\n<p>Komponentin <em>App</em> tilaan on nyt lisätty kenttä <em>loginVisible</em> joka määrittelee sen näytetäänkö kirjautumislomake.</p>\n<p>Näkyvyyttä säätelevää tilaa vaihdellaan kahden napin avulla, molempiin on kirjoitettu tapahtumankäsittelijän koodi suoraan:</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">&lt;button onClick={e =&gt; this.setState({ loginVisible: true })}&gt;log in&lt;/button&gt;\n\n&lt;button onClick={e =&gt; this.setState({ loginVisible: false })}&gt;cancel&lt;/button&gt;</code></pre></div>\n<p>Komponenttien näkyvyys on määritelty asettamalla komponentille CSS-määrittely, jossa <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/display\">display</a>-propertyn arvoksi asetetaan <em>none</em> jos komponentin ei haluta näkyvän:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">const hideWhenVisible = { display: this.state.loginVisible ? 'none' : '' } const\nshowWhenVisible = { display: this.state.loginVisible ? '' : 'none' } // ...\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token style-attr language-css\"><span class=\"token attr-name\"> <span class=\"token attr-name\">style</span></span><span class=\"token punctuation\">=\"</span><span class=\"token attr-value\"><span class=\"token punctuation\">{</span>hideWhenVisible<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>// nappi<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token style-attr language-css\"><span class=\"token attr-name\"> <span class=\"token attr-name\">style</span></span><span class=\"token punctuation\">=\"</span><span class=\"token attr-value\"><span class=\"token punctuation\">{</span>showWhenVisible<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>// lomake<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Käytössä on taas kysymysmerkkioperaattori, eli jos <em>this.state.loginVisible</em> on <em>true</em>, tulee napin CSS-määrittelyksi</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token property\">display</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>jos <em>this.state.loginVisible</em> on <em>false</em>, ei <em>display</em> saa mitään (napin näkyvyyteen liittyvää) arvoa.</p>\n<p>Hyödynsimme mahdollisuutta määritellä React-komponenteille koodin avulla <a href=\"https://react-cn.github.io/react/tips/inline-styles.html\">inline</a>-tyylejä. Palaamme asiaan tarkemmin seuraavassa osassa.</p>\n<h2>Komponentin lapset, eli this.props.children</h2>\n<p>Kirjautumislomakkeen näkyvyyttä ympäröivän koodin voi ajatella olevan oma looginen kokonaisuutensa ja se onkin hyvä eristää pois komponentista <em>App</em> omaksi komponentikseen.</p>\n<p>Tavoitteena on luoda komponentti <em>Togglable</em>, jota käytetään seuraavalla tavalla:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Togglable</span> <span class=\"token attr-name\">buttonLabel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>login<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LoginForm</span>\n    <span class=\"token attr-name\">username</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{this.state.username}</span>\n    <span class=\"token attr-name\">password</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{this.state.password}</span>\n    <span class=\"token attr-name\">handleChange</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{this.handleLoginFieldChange}</span>\n    <span class=\"token attr-name\">handleSubmit</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{this.login}</span>\n  <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Togglable</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Komponentin käyttö poikkeaa aiemmin näkemistämme siinä, että käytössä on nyt avaava ja sulkeva tagi, joiden sisällä määritellään toinen komponentti eli <em>LoginForm</em>. Reactin terminologiassa <em>LoginForm</em> on nyt komponentin <em>Togglable</em> lapsi.</p>\n<p><em>Togglablen</em> avaavan ja sulkevan tagin sisälle voi sijoittaa lapsiksi mitä tahansa React-elementtejä, esim.:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Togglable</span> <span class=\"token attr-name\">buttonLabel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>paljasta<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>tämä on aluksi piilossa<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>toinen salainen rivi<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Togglable</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Komponentin koodi on seuraavassa:</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">class Togglable extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      visible: false\n    }\n  }\n\n  toggleVisibility = () =&gt; {\n    this.setState({visible: !this.state.visible})\n  }\n\n  render() {\n    const hideWhenVisible = { display: this.state.visible ? &#39;none&#39; : &#39;&#39; }\n    const showWhenVisible = { display: this.state.visible ? &#39;&#39; : &#39;none&#39; }\n\n    return (\n      &lt;div&gt;\n        &lt;div style={hideWhenVisible}&gt;\n          &lt;button onClick={this.toggleVisibility}&gt;{this.props.buttonLabel}&lt;/button&gt;\n        &lt;/div&gt;\n        &lt;div style={showWhenVisible}&gt;\n          {this.props.children}\n          &lt;button onClick={this.toggleVisibility}&gt;cancel&lt;/button&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    )\n  }\n}</code></pre></div>\n<p>Mielenkiintoista ja meille uutta on <a href=\"https://reactjs.org/docs/glossary.html#propschildren\">this.props.children</a>, jonka avulla koodi viittaa komponentin lapsiin, eli avaavan ja sulkevan tagin sisällä määriteltyihin React-elementteihin.</p>\n<p>Tällä kertaa lapset ainoastaan renderöidään komponentin oman renderöivän koodin seassa:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token style-attr language-css\"><span class=\"token attr-name\"> <span class=\"token attr-name\">style</span></span><span class=\"token punctuation\">=\"</span><span class=\"token attr-value\"><span class=\"token punctuation\">{</span>showWhenVisible<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  {this.props.children}\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{this.toggleVisibility}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>cancel<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Toisin kuin \"normaalit\" propsit, <em>children</em> on Reactin automaattisesti määrittelemä, aina olemassa oleva propsi. Jos komponentti määritellään automaattisesti suljettavalla eli <em>/></em> loppuvalla tagilla, esim.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Note</span>\n  <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{note.id}</span>\n  <span class=\"token attr-name\">note</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{note}</span>\n  <span class=\"token attr-name\">toggleImportance</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{this.toggleImportanceOf(note.id)}</span>\n<span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>on <em>this.props.children</em> tyhjä taulukko.</p>\n<p>Komponentti <em>Togglable</em> on uusiokäytettävä ja voimme käyttää sitä tekemään myös uuden muistiinpanon luomisesta huolehtivan formin vastaavalla tavalla tarpeen mukaan näytettäväksi.</p>\n<p>Eristetään ensin muistiinpanojen luominen omaksi komponentiksi</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">const NoteForm = ({ onSubmit, handleChange, value}) =&gt; {\n  return (\n    &lt;div&gt;\n      &lt;h2&gt;Luo uusi muistiinpano&lt;/h2&gt;\n\n      &lt;form onSubmit={onSubmit}&gt;\n        &lt;input\n          value={value}\n          onChange={handleChange}\n        /&gt;\n        &lt;button type=&quot;submit&quot;&gt;tallenna&lt;/button&gt;\n      &lt;/form&gt;\n    &lt;/div&gt;\n  )\n}</code></pre></div>\n<p>ja määritellään lomakkeen näyttävä koodi komponentin <em>Togglable</em> sisällä</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Togglable</span> <span class=\"token attr-name\">buttonLabel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>new note<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>NoteForm</span>\n    <span class=\"token attr-name\">onSubmit</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{this.addNote}</span>\n    <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{this.state.newNote}</span>\n    <span class=\"token attr-name\">handleChange</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{this.handleNoteChange}</span>\n  <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Togglable</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h2>ref eli viite komponenttiin</h2>\n<p>Ratkaisu on melko hyvä, haluaisimme kuitenkin parantaa sitä erään seikan osalta.</p>\n<p>Kun uusi muistiinpano luodaan, olisi loogista jos luomislomake menisi piiloon. Nyt lomake pysyy näkyvillä. Lomakkeen piilottamiseen sisältyy kuitenkin pieni ongelma, sillä näkyvyyttä kontrolloidaan <em>Togglable</em>-komponentin tilassa olevalla muuttujalla ja komponentissa määritellyllä metodilla <em>toggleVisibility</em>. Miten pääsemme niihin käsiksi komponentin ulkopuolelta?</p>\n<p>Koska React-komponentit ovat Javascript-olioita, on niiden metodeja mahdollista kutsua jos komponenttia vastaavaan olioon onnistutaan saamaan viite.</p>\n<p>Eräs keino viitteen saamiseen on React-komponenttien attribuutti <a href=\"https://reactjs.org/docs/refs-and-the-dom.html#adding-a-ref-to-a-class-component\">ref</a>.</p>\n<p>Muutetaan lomakkeen renderöivää koodia seuraavasti:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>Togglable buttonLabel<span class=\"token operator\">=</span><span class=\"token string\">\"new note\"</span> ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>component <span class=\"token operator\">=</span><span class=\"token operator\">></span> this.noteForm <span class=\"token operator\">=</span> component<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>NoteForm\n      <span class=\"token punctuation\">..</span>.\n    /<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>/Togglable<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>/div<span class=\"token operator\">></span></code></pre></div>\n<p>Kun komponentti <em>Togglable</em> renderöidään, suorittaa React ref-attribuutin sisällä määritellyn funktion:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">component <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>noteForm <span class=\"token operator\">=</span> component<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>parametrin <em>component</em> arvona on viite komponenttiin. Funktio tallettaa viitteen muuttujaan <em>this.noteForm</em> eli <em>App</em>-komponentin kenttään <em>noteForm</em>.</p>\n<p>Nyt mistä tahansa komponentin <em>App</em> sisältä on mahdollista päästä käsiksi uusien muistiinpanojen luomisen sisältävään <em>Togglable</em>-komponenttiin.</p>\n<p>Voimme nyt piilottaa lomakkeen kutsumalla <em>this.noteForm.toggleVisibility()</em> samalla kun uuden muistiinpanon luominen tapahtuu:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function-variable function\">addNote</span> <span class=\"token operator\">=</span> e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>noteForm<span class=\"token punctuation\">.</span><span class=\"token function\">toggleVisibility</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ..</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Refeille on myös <a href=\"https://reactjs.org/docs/refs-and-the-dom.html\">muita käyttötarkoituksia</a> kuin React-komponentteihin käsiksi pääseminen.</p>\n<p>Sovelluksen tämänhetkinen koodi on kokonaisuudessaan <a href=\"https://github.com/fullstack-hy2019part2-notes/tree/part5-4\">githubissa</a>, tagissa <em>part5-4</em>.</p>\n<h3>Huomio komponenteista</h3>\n<p>Kun Reactissa määritellään komponentti</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Togglable</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ja otetaan se käyttöön seuraavasti</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">&lt;div&gt;\n  &lt;Togglable buttonLabel=&quot;1&quot; ref={component =&gt; this.t1 = component}&gt;\n    ensimmäinen\n  &lt;/Togglable&gt;\n\n  &lt;Togglable buttonLabel=&quot;2&quot; ref={component =&gt; this.t2 = component}&gt;\n    toinen\n  &lt;/Togglable&gt;\n\n  &lt;Togglable buttonLabel=&quot;3&quot; ref={component =&gt; this.t3 = component}&gt;\n    kolmas\n  &lt;/Togglable&gt;\n&lt;/div&gt;</code></pre></div>\n<p>syntyy <em>kolme erillistä komponenttiolioa</em>, joilla on kaikilla oma tilansa:</p>\n<picture><img src=\"/static/374425db96cf74f0606366ba4f6fcab3/14be6/5.png\" srcset=\"/static/374425db96cf74f0606366ba4f6fcab3/4cce7/5.png 200w,\n/static/374425db96cf74f0606366ba4f6fcab3/bae5f/5.png 400w,\n/static/374425db96cf74f0606366ba4f6fcab3/14be6/5.png 800w,\n/static/374425db96cf74f0606366ba4f6fcab3/1b35a/5.png 1200w,\n/static/374425db96cf74f0606366ba4f6fcab3/9ee03/5.png 1600w,\n/static/374425db96cf74f0606366ba4f6fcab3/8cea1/5.png 1878w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p><em>ref</em>-attribuutin avulla on talletettu viite jokaiseen komponenttiin muuttujiin <em>this.t1</em>, <em>this.t2</em> ja <em>this.t3</em>.</p>\n<h2>Tehtäviä</h2>\n<p>Tee nyt tehtävät <a href=\"/teht%C3%A4v%C3%A4t#komponenttien-n%C3%A4ytt%C3%A4minen-vain-tarvittaessa\">5.5-5.10</a></p>\n<h2>PropTypes</h2>\n<p>Komponentti <em>Togglable</em> olettaa, että sille määritellään propsina <em>buttonLabel</em> napin teksti. Jos määrittely unohtuu</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Togglable</span><span class=\"token punctuation\">></span></span> buttonLabel unohtui... <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Togglable</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Sovellus kyllä toimii, mutta selaimeen renderöityy hämäävästi nappi, jolla ei ole mitään tekstiä.</p>\n<p>Haluaisimmekin varmistaa että jos <em>Togglable</em>-komponenttia käytetään, on propsille \"pakko\" antaa arvo.</p>\n<p>Kirjaston olettamat ja edellyttämät propsit ja niiden tyypit voidaan määritellä kirjaston <a href=\"https://github.com/facebook/prop-types\">prop-types</a> avulla. Asennetaan kirjasto</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save prop-types</code></pre></div>\n<p><em>buttonLabel</em> voidaan määritellä <em>pakolliseksi</em> string-tyyppiseksi propsiksi seuraavasti</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">import PropTypes from &#39;prop-types&#39;\n\nclass Togglable extends React.Component {\n  // ...\n}\n\nTogglable.propTypes = {\n  buttonLabel: PropTypes.string.isRequired\n}</code></pre></div>\n<p>Jos propsia ei määritellä, seurauksena on konsoliin tulostuva virheilmoitus</p>\n<picture><img src=\"/static/41bb47a3ccd900b75691f688da28ae70/14be6/6.png\" srcset=\"/static/41bb47a3ccd900b75691f688da28ae70/4cce7/6.png 200w,\n/static/41bb47a3ccd900b75691f688da28ae70/bae5f/6.png 400w,\n/static/41bb47a3ccd900b75691f688da28ae70/14be6/6.png 800w,\n/static/41bb47a3ccd900b75691f688da28ae70/1b35a/6.png 1200w,\n/static/41bb47a3ccd900b75691f688da28ae70/9ee03/6.png 1600w,\n/static/41bb47a3ccd900b75691f688da28ae70/fa017/6.png 1692w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Koodi kuitenkin toimii edelleen, eli mikään ei pakota määrittelemään propseja PropTypes-määrittelyistä huolimatta. On kuitenkin erittäin epäprofessionaalia jättää konsoliin <em>mitään</em> punaisia tulosteita.</p>\n<p>Määritellään Proptypet myös <em>LoginForm</em>-komponentille:</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">import PropTypes from &#39;prop-types&#39;\n\nconst LoginForm = ({ handleSubmit, handleChange, username, password }) =&gt; {\n  return (\n    // ...\n  )\n}\n\nLoginForm.propTypes = {\n  handleSubmit: PropTypes.func.isRequired,\n  handleChange: PropTypes.func.isRequired,\n  username: PropTypes.string.isRequired,\n  password: PropTypes.string.isRequired\n}</code></pre></div>\n<p>Funktionaalisen komponentin proptypejen määrittely tapahtuu samalla tavalla kuin luokkaperustaisten.</p>\n<p>Jos propsin tyyppi on väärä, esim. yritetään määritellä propsiksi <em>handleChange</em> merkkijono, seurauksena on varoitus:</p>\n<picture><img src=\"/static/cd199a5b2270dd60ddc9fb452ef9761d/14be6/7.png\" srcset=\"/static/cd199a5b2270dd60ddc9fb452ef9761d/4cce7/7.png 200w,\n/static/cd199a5b2270dd60ddc9fb452ef9761d/bae5f/7.png 400w,\n/static/cd199a5b2270dd60ddc9fb452ef9761d/14be6/7.png 800w,\n/static/cd199a5b2270dd60ddc9fb452ef9761d/1b35a/7.png 1200w,\n/static/cd199a5b2270dd60ddc9fb452ef9761d/9ee03/7.png 1600w,\n/static/cd199a5b2270dd60ddc9fb452ef9761d/536b3/7.png 1728w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Luokkaperustaisille komponenteille PropTypet on mahdollista määritellä myös <em>luokkamuuttujina</em>, seuraavalla syntaksilla:</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">import PropTypes from &#39;prop-types&#39;\n\nclass Togglable extends React.Component {\n  static propTypes = {\n    buttonLabel: PropTypes.string.isRequired\n  }\n\n  // ...\n}</code></pre></div>\n<p>Muuttujamäärittelyn edessä oleva <em>static</em> määrittelee nyt, että <em>propTypes</em>-kenttä on nimenomaan komponentin määrittelevällä luokalla <em>Togglable</em> eikä luokan instansseilla. Oleellisesti ottaen kyseessä on ainoastaan Javascriptin vielä standardoimattoman <a href=\"https://github.com/tc39/proposal-class-fields\">ominaisuuden</a> mahdollistava syntaktinen oikotie määritellä seuraava:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">Togglable<span class=\"token punctuation\">.</span>propTypes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  buttonLabel<span class=\"token punctuation\">:</span> PropTypes<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Surffatessasi internetissä saatat vielä nähdä ennen Reactin versiota 0.16 tehtyjä esimerkkejä, joissa PropTypejen käyttö ei edellytä erillistä kirjastoa. Versiosta 0.16 alkaen PropTypejä ei enää määritelty React-kirjastossa itsessään ja kirjaston <em>prop-types</em> käyttö on pakollista.</p>\n<h2>Tehtäviä</h2>\n<p>Tee nyt tehtävä <a href=\"/teht%C3%A4v%C3%A4t#proptypet\">5.11</a></p>\n</div>","frontmatter":{"mainImage":{"publicURL":"/static/part-5-1d38df3161654915a233d16795c6c490.svg"},"part":5,"letter":"b"}}},"pageContext":{"part":5,"letter":"b"}}