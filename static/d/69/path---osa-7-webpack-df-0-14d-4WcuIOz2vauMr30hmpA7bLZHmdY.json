{"data":{"markdownRemark":{"html":"<div class=\"content\">\n<h2>Webpack</h2>\n<p>React on ollut jossain määrin kuuluisa siitä, että sovelluskehityksen edellyttämien työkalujen konfigurointi on ollut hyvin hankalaa. Kiitos <a href=\"https://github.com/facebookincubator/create-react-app\">create-react-app</a>:in, sovelluskehitys Reactilla on kuitenkin nykyään tuskatonta, parempaa työskentelyflowta on tuskin ollut koskaan Javascriptillä tehtävässä selainpuolen sovelluskehityksessä.</p>\n<p>Emme voi kuitenkaan turvautua ikuisesti create-react-app:in magiaan ja nyt onkin aika selvittää mitä kaikkea taustalla on. Avainasemassa React-sovelluksen toimintakuntoon saattamisessa on <a href=\"https://webpack.js.org/\">webpack</a>-niminen työkalu.</p>\n<h3>bundlaus</h3>\n<p>Olemme toteuttaneet sovelluksia jakamalla koodin moduuleihin, joita on <em>importattu</em> niitä tarvitseviin paikkoihin. Vaikka ES6-moduulit ovatkin Javascript-standardissa määriteltyjä, ei mikään selain vielä osaa käsitellä moduuleihin jaettua koodia.</p>\n<p>Selainta varten moduuleissa oleva koodi <em>bundlataan</em>, eli siitä muodostetaan yksittäinen, kaiken koodin sisältävä tiedosto. Kun veimme Reactilla toteutetun frontendin tuotantoon osan 3 luvussa <a href=\"/osa3#frontendin-tuotantoversio\">Frontendin tuotantoversio</a>, suoritimme bundlauksen komennolla <em>npm run build</em>. Konepellin alla kyseinen npm-skripti suorittaa bundlauksen webpackia hyväksi käyttäen. Tuloksena on joukko hakemistoon <em>build</em> sijoitettavia tiedostoja:</p>\n<pre>\n├── asset-manifest.json\n├── favicon.ico\n├── index.html\n├── manifest.json\n├── service-worker.js\n└── static\n    ├── css\n    │   ├── main.1b1453df.css\n    │   └── main.1b1453df.css.map\n    └── js\n        ├── main.54f11b10.js\n        └── main.54f11b10.js.map\n</pre>\n<p>Hakemiston juuressa oleva sovelluksen \"päätiedosto\" <em>index.html</em> lataa <em>script</em>-tagin avulla bundlatun Javascript-tiedoston:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>React App<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/static/css/main.1b1453df.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/static/js/main.54f11b10.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Kuten esimerkistä näemme, create-react-app:illa tehdyssä sovelluksessa bundlataan Javascriptin lisäksi sovelluksen CSS-määrittelyt tiedostoon <em>static/css/main.1b1453df.css</em></p>\n<p>Käytännössä bundlaus tapahtuu siten, että sovelluksen Javascriptille määritellään alkupiste, usein tiedosto <em>index.js</em>, ja bundlauksen yhteydessä webpack ottaa mukaan kaiken koodin mitä alkupiste importtaa, sekä importattujen koodien importtaamat koodit, jne.</p>\n<p>Koska osa importeista on kirjastoja, kuten React, Redux ja Axios, bundlattuun javascript-tiedostoon tulee myös kaikkien näiden sisältö.</p>\n<blockquote>\n<p>Vanha tapa jakaa sovelluksen koodi moneen tiedostoon perustui siihen, että <em>index.html</em> latasi kaikki sovelluksen tarvitsemat erilliset Javascript-tiedostot script-tagien avulla. Tämä on kuitenkin tehotonta, sillä jokaisen tiedoston lataaminen aiheuttaa pienen overheadin ja nykyään pääosin suositaankin koodin bundlaamista yksittäiseksi tiedostoksi.</p>\n</blockquote>\n<p>Tehdään nyt React-projektille sopiva webpack-konfiguraatio kokonaan käsin.</p>\n<p>Luodaan projektia varten hakemisto ja sen sisälle seuraavat hakemistot (dist ja src) sekä tiedostot:</p>\n<pre>\n├── dist\n├── package.json\n├── src\n│   └── index.js\n└── webpack.config.js\n</pre>\n<p>Tiedoston <em>package.json</em> sisältö voi olla esim. seuraava:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"webpack-osa7\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"practising webpack\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"license\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MIT\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Asennetaan webpack komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev webpack webpack-cli</code></pre></div>\n<p>Webpackin toiminta konfiguroidaan tiedostoon <em>webpack.config.js</em>, laitetaan sen alustavaksi sisällöksi seuraava</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">const path <span class=\"token operator\">=</span> require<span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span>\n\nconst config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  entry: <span class=\"token string\">'./src/index.js'</span>,\n  output: <span class=\"token punctuation\">{</span>\n    path: path.resolve<span class=\"token punctuation\">(</span>__dirname, <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span>,\n    filename: <span class=\"token string\">'main.js'</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\nmodule.exports <span class=\"token operator\">=</span> config</code></pre></div>\n<p>Määritellään sitten npm-skripti <em>build</em> jonka avulla bundlaus suoritetaan</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">// <span class=\"token punctuation\">..</span>.\n<span class=\"token string\">\"scripts\"</span><span class=\"token keyword\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"build\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"webpack --mode=development\"</span>\n<span class=\"token punctuation\">}</span>,\n// <span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>Lisätään hieman koodia tiedostoon <em>src/index.js</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">hello</span> <span class=\"token operator\">=</span> name <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`hello </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Kun nyt suoritamme komennon <em>npm run build</em> webpack bundlaa koodin. Tuloksena on hakemistoon <em>dist</em> sijoitettava tiedosto <em>main.js</em>:</p>\n<picture><img src=\"/static/6433076ef5df206c63279b982704150f/14be6/1.png\" srcset=\"/static/6433076ef5df206c63279b982704150f/4cce7/1.png 200w,\n/static/6433076ef5df206c63279b982704150f/bae5f/1.png 400w,\n/static/6433076ef5df206c63279b982704150f/14be6/1.png 800w,\n/static/6433076ef5df206c63279b982704150f/16a28/1.png 1136w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Tiedostossa on paljon erikoisen näköistä tavaraa. Lopussa on mukana myös kirjoittamamme koodi.</p>\n<p>Lisätään hakemistoon <em>src</em> tiedosto <em>App.js</em> ja sille sisältö</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Importataan ja käytetään modulia <em>App</em> tiedostossa <em>index.js</em></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> App <span class=\"token keyword\">from</span> <span class=\"token string\">'./App'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">hello</span> <span class=\"token operator\">=</span> name <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`hello </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Kun nyt suoritamme bundlauksen komennolla <em>npm run build</em> huomaamme webpackin havainneen molemmat tiedostot:</p>\n<picture><img src=\"/static/21921fb9c9fb2d288aced172687b234f/14be6/2.png\" srcset=\"/static/21921fb9c9fb2d288aced172687b234f/4cce7/2.png 200w,\n/static/21921fb9c9fb2d288aced172687b234f/bae5f/2.png 400w,\n/static/21921fb9c9fb2d288aced172687b234f/14be6/2.png 800w,\n/static/21921fb9c9fb2d288aced172687b234f/0ab6d/2.png 1138w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Kirjoittamamme koodi löytyy melko kryptisesti muotoiltuna bundlen lopussa:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/***/</span> <span class=\"token string\">\"./src/App.js\"</span><span class=\"token punctuation\">:</span>\n<span class=\"token comment\">/*!********************!*\\\n  !*** ./src/App.js ***!\n  \\********************/</span>\n<span class=\"token comment\">/*! exports provided: default */</span>\n<span class=\"token comment\">/***/</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>module<span class=\"token punctuation\">,</span> __webpack_exports__<span class=\"token punctuation\">,</span> __webpack_require__<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">eval</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"__webpack_require__.r(__webpack_exports__);\\nconst App = () => {\\n  return null;\\n};\\n\\n/* harmony default export */ __webpack_exports__[\\\"default\\\"] = (App);\\n\\n//# sourceURL=webpack:///./src/App.js?\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/***/</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token comment\">/***/</span> <span class=\"token string\">\"./src/index.js\"</span><span class=\"token punctuation\">:</span>\n<span class=\"token comment\">/*!**********************!*\\\n  !*** ./src/index.js ***!\n  \\**********************/</span>\n<span class=\"token comment\">/*! no exports provided */</span>\n<span class=\"token comment\">/***/</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>module<span class=\"token punctuation\">,</span> __webpack_exports__<span class=\"token punctuation\">,</span> __webpack_require__<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">eval</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"__webpack_require__.r(__webpack_exports__);\\n/* harmony import */ var _App__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./App */ \\\"./src/App.js\\\");\\n\\n\\nconst hello = name => {\\n  console.log(`hello ${name}`);\\n};\\n\\nObject(_App__WEBPACK_IMPORTED_MODULE_0__[\\\"default\\\"])();\\n\\n//# sourceURL=webpack:///./src/index.js?\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Konfiguraatiotiedosto</h3>\n<p>Katsotaan nyt tarkemmin konfiguraation <em>webpack.config.js</em> tämänhetkistä sisältöä:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  entry<span class=\"token punctuation\">:</span> <span class=\"token string\">'./src/index.js'</span><span class=\"token punctuation\">,</span>\n  output<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'main.js'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> config<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Konfiguraatio on Javascriptia ja tapahtuu eksporttaamalla määrittelyt sisältävä olio Noden moduulisyntaksilla.</p>\n<p>Tämän hetkinen minimaalinen määrittely on aika ilmeinen, kenttä <a href=\"https://webpack.js.org/concepts/#entry\">entry</a> kertoo sen tiedoston, mistä bundlaus aloitetaan.</p>\n<p>Kenttä <a href=\"https://webpack.js.org/concepts/#output\">output</a> taas kertoo minne muodostettu bundle sijoitetaan. Kohdehakemisto täytyy määritellä <em>absoluuttisena polkuna</em>, se taas onnistuu helposti <a href=\"https://nodejs.org/docs/latest-v8.x/api/path.html#path_path_resolve_paths\">path.resolve</a>-metodilla. <a href=\"https://nodejs.org/docs/latest/api/globals.html#globals_dirname\">__dirname</a> on Noden globaali muuttuja, joka viittaa nykyiseen hakemistoon.</p>\n<h3>Webpack 4</h3>\n<p>Helmikuun viimeisten päivien aikana julkaistu Webpackin versio 4 on vähentänyt välttämättömän konfiguroinnin määrää määrittelemällä Webpackille joukon oletusarvoisia konfiguraatioita.</p>\n<p>Konfiguraatiossamme <em>entryllä</em> ja <em>outputilla</em> on niiden oletusarvo, eli voisimme myös jättää ne määrittelemättä, ja tiedoston <em>webpack.config.js</em> sisällöksi kävisi:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> config<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Jätämme kuitenkin <em>entryn</em> ja <em>outputin</em> määrittelyt tiedostoon.</p>\n<h3>Reactin bundlaaminen</h3>\n<p>Muutetaan sitten sovellus minimalistiseksi React-sovellukseksi. Asennetaan tarvittavat kirjastot</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save react react-dom</code></pre></div>\n<p>Liitetään tavanomaiset loitsut tiedostoon <em>index.js</em></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> ReactDOM <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> App <span class=\"token keyword\">from</span> <span class=\"token string\">'./App'</span><span class=\"token punctuation\">;</span>\n\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ja muutetaan <em>App.js</em> muotoon</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">import React from &#39;react&#39;\n\nconst App = () =&gt; (\n  &lt;div&gt;hello webpack&lt;/div&gt;\n)\n\nexport default App</code></pre></div>\n<p>Tarvitsemme sovellukselle myös \"pääsivuna\" toimivan tiedoston <em>dist/index.html</em> joka lataa <em>script</em>-tagin avulla bundlatun Javascriptin:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>React App<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>./main.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Kun bundlaamme sovelluksen, törmäämme kuitenkin ongelmaan</p>\n<picture><img src=\"/static/01bbf01876bbaa3d005ed18eb267d0b4/14be6/3.png\" srcset=\"/static/01bbf01876bbaa3d005ed18eb267d0b4/4cce7/3.png 200w,\n/static/01bbf01876bbaa3d005ed18eb267d0b4/bae5f/3.png 400w,\n/static/01bbf01876bbaa3d005ed18eb267d0b4/14be6/3.png 800w,\n/static/01bbf01876bbaa3d005ed18eb267d0b4/ea1cd/3.png 1130w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<h3>Loaderit</h3>\n<p>Webpack mainitsee että saatamme tarvita <em>loaderin</em> tiedoston <em>App.js</em> käsittelyyn. Webpack ymmärtää itse vain Javascriptia ja vaikka se saattaa meiltä matkan varrella olla unohtunutkin, käytämme Reactia ohjelmoidessamme <a href=\"https://facebook.github.io/jsx/\">JSX</a>:ää näkymien renderöintiin, eli esim. seuraava</p>\n<div class=\"gatsby-highlight\" data-language=\"react\"><pre class=\"language-react\"><code class=\"language-react\">const App = () =&gt; (\n  &lt;div&gt;hello webpack&lt;/div&gt;\n)</code></pre></div>\n<p>ei ole \"normaalia\" Javascriptia, vaan JSX:n tarjoama syntaktinen oikotie määritellä <em>div</em>-tagiä vastaava React-elementti.</p>\n<p><a href=\"https://webpack.js.org/concepts/loaders/\">Loaderien</a> avulla on mahdollista kertoa webpackille miten tiedostot tulee käsitellä ennen niiden bundlausta.</p>\n<p>Määritellään projektiimme Reactin käyttämän JSX:n normaaliksi Javascriptiksi muuntava loaderi:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  entry<span class=\"token punctuation\">:</span> <span class=\"token string\">'./src/index.js'</span><span class=\"token punctuation\">,</span>\n  output<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    filename<span class=\"token punctuation\">:</span> <span class=\"token string\">'main.js'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  module<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    rules<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span><span class=\"token punctuation\">,</span>\n        loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n        query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          presets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Loaderit määritellään kentän <em>module</em> alle sijoitettavaan taulukkoon <em>rules</em>.</p>\n<p>Yksittäisen loaderin määrittely on kolmiosainen:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span><span class=\"token punctuation\">,</span>\n  loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n  query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    presets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Kenttä <em>test</em> määrittelee että käsitellään <em>.js</em>-päätteisiä tiedostoja, <em>loader</em> kertoo että käsittely tapahtuu <a href=\"https://github.com/babel/babel-loader\">babel-loader</a>:illa. Kenttä <em>query</em> taas antaa loaderille sen toimintaa ohjaavia parametreja.</p>\n<p>Asennetaan loader ja sen tarvitsemat kirjastot <em>kehitysaikaiseksi riippuvuudeksi</em>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev babel-core babel-loader babel-preset-react</code></pre></div>\n<p>Nyt bundlaus onnistuu.</p>\n<p>Jos katsomme bundlattua koodia, huomaamme, että komponentti <em>App</em> on muuttunut muotoon</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  react__WEBPACK_IMPORTED_MODULE_0___default<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'div'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'hello webpack'</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Eli JSX-syntaksin sijaan komponentit luodaan pelkällä Javascriptilla käyttäen Reactin funktiota <a href=\"https://reactjs.org/docs/react-without-jsx.html\">createElement</a>.</p>\n<p>Sovellusta voi nyt kokeilla avaamalla tiedoston dist/index.html* selaimen _open file* -toiminnolla:</p>\n<picture><img src=\"/static/c186187dbead4d9f525df4955439913b/14be6/4.png\" srcset=\"/static/c186187dbead4d9f525df4955439913b/4cce7/4.png 200w,\n/static/c186187dbead4d9f525df4955439913b/bae5f/4.png 400w,\n/static/c186187dbead4d9f525df4955439913b/14be6/4.png 800w,\n/static/c186187dbead4d9f525df4955439913b/1b35a/4.png 1200w,\n/static/c186187dbead4d9f525df4955439913b/0b406/4.png 1388w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Tässä on jo melkein kaikki mitä tarvitsemme React-sovelluskehitykseen.</p>\n<h3>Transpilaus</h3>\n<p>Prosessista, joka muuttaa Javascriptia muodosta toiseen käytetään englanninkielistä termiä <a href=\"https://en.wiktionary.org/wiki/transpile\">transpiling</a>, joka taas on termi, joka viittaa koodin kääntämiseen (compile) sitä muuntamalla (transform). Suomenkielisen termin puuttuessa käytämme prosessista tällä kurssilla nimitystä <em>transpilaus</em>.</p>\n<p>Edellisen luvun konfiguraation avulla siis <em>transpiloimme</em> JSX:ää sisältävän Javascriptin normaaliksi Javascriptiksi tämän hetken johtavan työkalun <a href=\"https://babeljs.io/\">babelin</a> avulla.</p>\n<p>Kuten osassa 1 jo mainittiin, läheskään kaikki selaimet eivät vielä osaa Javascriptin uusimpien versioiden ES6:n ja ES7:n ominaisuuksia ja tämän takia koodi yleensä transpiloidaan käyttämään vanhempaa Javascript-syntaksia ES5:ttä.</p>\n<p>Babelin suorittama transpilointiprosessi määritellään <em>pluginien</em> avulla. Käytännössä useimmiten käytetään valmiita <a href=\"https://babeljs.io/docs/plugins/\">presetejä</a>, eli useamman sopivan pluginin joukkoja.</p>\n<p>Tällä hetkellä sovelluksemme transpiloinnissa käytetään presetiä <a href=\"https://babeljs.io/docs/plugins/preset-react/\">react</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span><span class=\"token punctuation\">,</span>\n  loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n  query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    presets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Otetaan käyttöön preset <a href=\"https://babeljs.io/docs/plugins/preset-env/\">env</a>, joka sisältää kaiken hyödyllisen, minkä avulla uusimman standardin mukainen koodi saadaan transpiloitua ES5-standardin mukaiseksi koodiksi:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span><span class=\"token punctuation\">,</span>\n  loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n  query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    presets<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'env'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Preset asennetaan komennolla</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">npm install babel<span class=\"token operator\">-</span>preset<span class=\"token operator\">-</span>env <span class=\"token operator\">--</span>save<span class=\"token operator\">-</span>dev</code></pre></div>\n<p>Kun nyt transpiloimme koodin, muuttuu se vanhan koulukunnan Javascriptiksi. Komponentin <em>App</em> määrittely näyttää seuraavalta:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> _react2<span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hello webpack'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Muuttujan määrittely tapahtuu avainsanan <em>var</em> avulla, sillä ES5 ei tunne avainsanaa <em>const</em>. Myöskään nuolifunktiot eivät ole käytössä, joten funktiomäärittely käyttää avainsanaa <em>function</em>.</p>\n</div>","frontmatter":{"path":"/osa7/webpack","mainImage":{"publicURL":"/static/part-7-e86c21108367fe9d9c833e8905547e9c.svg"},"part":7,"letter":"a"}}},"pageContext":{}}