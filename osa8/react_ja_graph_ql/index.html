<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/0.cfc6744424f23f9f1dc5.css">@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,500,600);@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400);.element--flex{display:flex;flex-wrap:wrap}.element--space-around{justify-content:space-around}.element--space-between{justify-content:space-between}.element--column{flex-direction:column}.element--centered{align-items:center;justify-content:center!important}@media (min-width:992px){.element--centered-in-desktop{align-items:center;justify-content:center!important}}@media (min-width:992px){.element--horizontal-half{width:45%}}.element--auto-margin{margin:auto}.element--auto-bottom-margin{margin-bottom:auto}.element--flex-start{align-content:flex-start}.element--no-wrap{flex-wrap:nowrap}.element--relative{position:relative!important}.image__content{position:absolute;top:0;left:0;height:100%;width:100%;-o-object-fit:cover;object-fit:cover}.image--contain .image__content{-o-object-fit:contain;object-fit:contain}.image{overflow:hidden;width:100%;position:relative}@media (min-width:992px){.image{width:40%}}.image .image__container{height:0;position:relative;width:100%;padding-bottom:89.0625%}.image--circle{border-radius:50%}.image--circle .image__content{background-color:#e1e1e1}.image--square-big{width:100%}.image--square-big .image__container{width:100%;padding-bottom:100%}.image--extra-small{width:8%}.image--extra-small .image__container{width:100%;padding-bottom:100%}@media (max-width:639px){.image--extra-small{width:calc(33.33333% - 1rem)}}.image--small{width:15%}.image--small .image__container{width:100%;padding-bottom:100%}@media (max-width:639px){.image--small{width:calc(33.33333% - 1rem)}}.image--medium{width:50%}.image--medium .image__container{width:100%;padding-bottom:71.25%}.image--large{width:100%}@media (min-width:992px){.image--large{width:60%}}.image--large .image__container{padding-bottom:59.37%;width:100%}.image--full-width{width:100%}.image--full-width .image__container{padding-bottom:59.37%;width:100%}.image--actual-size{width:100%}.image--actual-size .image__container{height:0;position:relative;width:100%;padding-bottom:60%}.navigation{z-index:2;list-style:none;opacity:0;display:none;margin:0;padding:5%;flex-direction:column;justify-content:center;align-items:center;background:#e1e1e1;position:fixed;top:8%;right:5%;transition:opacity .3s ease-in-out;font-weight:200}@media (min-width:640px){.navigation{display:flex;opacity:1;padding:0;font-weight:400;position:static;background:none;overflow:hidden;flex-direction:row}}.navigation__toggle{z-index:3;position:absolute;top:0;right:0;width:50px;height:40px;cursor:pointer;border:none;background:none;outline:none;border-radius:4px}@media (min-width:640px){.navigation__toggle{display:none}}.navigation__mobile-logo{display:none}.navigation__toggle-icon{top:8px;left:10px}.navigation__toggle-icon,.navigation__toggle-icon:after,.navigation__toggle-icon:before{position:absolute;width:30px;height:3px;transition:all .3s ease;border-radius:4px;background-color:#33332d}.navigation__toggle-icon:after,.navigation__toggle-icon:before{content:"";display:block}.navigation__toggle-icon:before{top:10px}.navigation__toggle-icon:after{top:20px}.is-open--navigation{overflow:hidden}.is-open--navigation .navigation{opacity:1;display:unset}.is-open--navigation .navigation:before{content:"";background-color:#e1e1e1;position:absolute;width:25px;height:25px;top:-3px;right:13px;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.is-open--navigation .navigation__mobile-logo{display:block;width:30px;height:30px;position:absolute;top:47px;left:5%}@media (min-width:640px){.is-open--navigation .navigation__mobile-logo{display:none}}.is-open--navigation .navigation__toggle-icon{-webkit-transform:translate3d(0,10px,0) rotate(45deg);transform:translate3d(0,10px,0) rotate(45deg)}.is-open--navigation .navigation__toggle-icon,.is-open--navigation .navigation__toggle-icon:after,.is-open--navigation .navigation__toggle-icon:before{background:#33332d}.is-open--navigation .navigation__toggle-icon:before{-webkit-transform:rotate(-45deg) translate3d(-5.71429px,-6px,0);transform:rotate(-45deg) translate3d(-5.71429px,-6px,0);opacity:0}.is-open--navigation .navigation__toggle-icon:after{-webkit-transform:translate3d(0,-19px,0) rotate(-90deg);transform:translate3d(0,-19px,0) rotate(-90deg)}.navigation__item{margin:22px 0;white-space:nowrap}.navigation__item:first-of-type{margin:0 0 22px}.navigation__item:last-of-type{margin:22px 0 0}@media (min-width:640px){.navigation__item{margin:0 30px;padding:0!important}.navigation__item:first-of-type{margin:0 30px 0 2rem}.navigation__item:last-of-type{margin:0 0 0 30px}}html{font-family:IBM Plex Mono,monospace;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:IBM Plex Mono,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em IBM Plex Mono,monospace;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:IBM Plex Mono,monospace;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{margin:2rem 0 -.5rem;font-size:1.38316rem}h3,h4{padding:0;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{margin:2rem 0 -1rem;font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:IBM Plex Mono,monospace;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}body,html{margin:0;padding:0;font-family:IBM Plex Mono,monospace;font-weight:500;color:#33332d;font-size:14px;line-height:1.555rem}@media (min-width:992px){body,html{font-size:18px}}p{margin:0;text-align:left;line-height:1.5em}a,p{color:#33332d}a{text-decoration:none}.link a{border-bottom:2px solid #e1e1e1}.link a:hover{background-color:#e1e1e1}.container{position:relative;margin:0 auto;display:flex;flex-wrap:wrap;justify-content:space-between;width:90%;max-width:1200px}@media (min-width:992px){.container--right{margin-right:5%;width:54%;max-width:719.9856px}}@media (min-width:992px) and (min-width:1200px){.container--right{margin-right:calc((100% - 1200px)/2)}}.hidden{display:none!important}.centered{text-align:center}@media (max-width:639px){.centered--mobile{justify-content:center;align-content:center;align-items:center}}.spacing{margin-top:2rem}@media (min-width:992px){.spacing{margin-top:5rem}}.spacing--small{margin-top:1rem}@media (min-width:992px){.spacing--small{margin-top:3.444rem}}.spacing--large{margin-top:4rem}@media (min-width:992px){.spacing--large{margin-top:10rem}}.spacing--extra-large{margin-top:4rem}@media (min-width:992px){.spacing--extra-large{margin-top:20rem}}.spacing--after{margin-bottom:2rem}@media (min-width:992px){.spacing--after{margin-bottom:5rem}}@media (min-width:992px){.spacing--after-small{margin-bottom:2.5rem}}.spacing--after-large{margin-bottom:4rem}@media (min-width:992px){.spacing--after-large{margin-bottom:10rem}}@media (max-width:991px){.spacing--mobile{margin-top:2rem}}.col-1{width:100%}@media (min-width:992px){.col-1{width:10%}}.col-2{width:100%}@media (min-width:992px){.col-2{width:20%}}.col-3{width:100%}@media (min-width:992px){.col-3{width:30%}}.col-4{width:100%}@media (min-width:992px){.col-4{width:40%}}.col-5{width:100%}@media (min-width:992px){.col-5{width:50%}}.col-6{width:100%}@media (min-width:992px){.col-6{width:60%}}.col-7{width:100%}@media (min-width:992px){.col-7{width:70%}}.col-8{width:100%}@media (min-width:992px){.col-8{width:80%}}.col-9{width:100%}@media (min-width:992px){.col-9{width:90%}}.col-10{width:100%}@media (min-width:992px){.col-10{width:100%}}@media (min-width:992px){.push-right-1{margin-left:10%}.push-right-2{margin-left:20%}.push-right-3{margin-left:30%}.push-right-4{margin-left:40%}.push-right-5{margin-left:50%}.push-left-1{margin-right:10%}.push-left-2{margin-right:20%}.push-left-3{margin-right:30%}.push-left-4{margin-right:40%}.push-left-5{margin-right:50%}.push-left{margin-right:auto}.push-right{margin-left:auto}}@media (max-width:991px){.col-1--mobile{width:10%}.col-2--mobile{width:20%}.col-3--mobile{width:30%}.col-4--mobile{width:40%}.col-5--mobile{width:50%}.col-6--mobile{width:60%}.col-7--mobile{width:70%}.col-8--mobile{width:80%}.col-9--mobile{width:90%}.col-10--mobile{width:100%}.order-0--mobile{order:0}.order-1--mobile{order:1}.order-2--mobile{order:2}.order-3--mobile{order:3}.order-4--mobile{order:4}.order-5--mobile{order:5}.hidden--mobile{display:none}}.centered-vertically{display:flex;flex-direction:column;justify-content:center}.nav-item-hover{text-decoration:none;color:#33332d;font-weight:500;padding:.2em}@media (min-width:640px){.nav-item-hover{font-weight:600;font-size:1.111rem}}.nav-item-hover:active,.nav-item-hover:focus,.nav-item-hover:hover{color:#fff;background-color:#33332d}.nav-item-hover:active,.nav-item-hover:focus{outline:2px solid #706be4}.flex-fix-aligning:after,.flex-fix-aligning:before{content:"";width:30%;order:2}.index__main-title{font-size:1.571rem}@media (min-width:992px){.index__main-title{font-size:3rem}}.auto-bottom-margin{margin-bottom:auto}@media (min-width:992px){.absolute-top-right--desktop{position:absolute;top:0;right:0}}@media (min-width:640px){.frontpage__hero .image{top:-2em}}@media (min-width:992px){.frontpage__hero{flex-direction:column}.frontpage__hero .image{top:4em}}.heading-font{font-family:IBM Plex Sans,monospace}.header{position:-webkit-sticky;position:sticky;z-index:200;top:0;transition:top .2s ease-in-out;box-sizing:border-box;width:100%;padding-top:1.444rem;padding-bottom:1rem;transition:all .2s ease-in-out}.header__logo{margin:0 10px}.triple-border{position:relative;padding:2px;border-radius:5px 0;transition:color .1s ease-in-out,background-color .1s ease-in-out}.triple-border:after,.triple-border:before{content:"";border:2px solid #33332d;border-radius:5px;position:absolute;width:calc(100% + 5px);height:calc(100% + 5px)}.triple-border:before{left:0;top:0}.triple-border:after{bottom:0;right:0}.triple-border__container{overflow:hidden;border-radius:3px 0}.triple-border--large-margin{margin:13px;padding:3px}.triple-border--large-margin:after,.triple-border--large-margin:before{content:"";border-width:3px;border-radius:13px;width:calc(100% + 13px);height:calc(100% + 13px)}.triple-border--large-margin .triple-border__container{border-radius:10px 0}.triple-border__logo{padding:.2rem;font-size:1.111rem;font-weight:600}.triple-border__return-tasks{font-size:.9rem;padding:1rem .2rem}</style><style data-href="/app.f588656cc80a065e5f1e.css">code[class*=language-],pre[class*=language-]{color:#fff;background:none;text-shadow:0 -.1em .2em #000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}:not(pre)>code[class*=language-],pre[class*=language-]{background:#4d4033}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:.3em solid #7a6652;border-radius:.5em;box-shadow:inset 1px 1px .5em #000}:not(pre)>code[class*=language-]{padding:.15em .2em .05em;border-radius:.3em;border:.13em solid #7a6652;box-shadow:inset 1px 1px .3em -.1em #000;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#998066}.namespace,.token.punctuation{opacity:.7}.token.boolean,.token.constant,.token.number,.token.property,.token.symbol,.token.tag{color:#d1949e}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#bde052}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f5b83d}.token.atrule,.token.attr-value,.token.keyword{color:#d1949e}.token.important,.token.regex{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.deleted{color:red}</style><style data-href="/component---src-templates-content-template-js.59a575ad88fdbaeba17d.css">@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,500,600);@import url(https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400);.course{position:relative;width:100%}.course p{font-family:IBM Plex Sans,monospace}@media (min-width:640px){.course p{margin-left:1rem}}.course p:not(:last-of-type){margin-bottom:1rem}@media (min-width:640px){.course h1{margin-left:3rem}}.course h2,.course h3,.course h4{padding-bottom:2rem}@media (min-width:640px){.course h2,.course h3,.course h4,.course table{margin-left:1rem}}.course ul{font-family:IBM Plex Sans,monospace}@media (min-width:640px){.course ul{margin-left:2.2rem}}.course h2:not(:first-of-type){margin-top:2rem}.course pre{margin:2rem 0;background-color:#33332d;color:#fff}.course em{font-family:Courier;font-style:normal;background-color:hsla(0,0%,88.2%,.6);padding:1px 5px 2px}.course img{border:11px solid transparent}.course .banner,.course .container{position:static}.course .letter{width:4rem;height:4rem;border-width:5px;border-style:solid;border-radius:2.5rem;text-align:center;margin:1rem;line-height:1.3em;-webkit-transform:translate(-1rem);transform:translate(-1rem)}@media (min-width:640px){.course .letter{-webkit-transform:translate(-3rem,4.5rem);transform:translate(-3rem,4.5rem)}}.course .letter,.course h1{font-size:2.3rem;font-weight:700}.course-content a,.tasks a{border:0;border-bottom-width:2px;border-style:solid;padding:2px}.course-content{max-width:100%}.tasks a{border-color:#33332d!important}.tasks a:hover{background-color:#fff!important;color:#000!important}.gatsby-highlight-code-line{background-color:hsla(0,0%,88.2%,.3);display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:1em}code[class*=language-],pre[class*=language-]{text-shadow:none}.arrow-go-up{width:36px;height:36px;position:fixed;bottom:5%;right:5%;z-index:99999;cursor:pointer}@media (max-width:639px){.arrow-go-up{right:10%}}.arrow__container{position:relative}.arrow__container:not():first-child{background:none;background-color:none}@media (min-width:640px){.arrow__container:not():first-child{border-left:none}.arrow__container:not():first-child:before{content:"";background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NzcuMTc1IDQ3Ny4xNzUiPjxwYXRoIGQ9Ik0zNjAuNzMxIDIyOS4wNzVsLTIyNS4xLTIyNS4xYy01LjMtNS4zLTEzLjgtNS4zLTE5LjEgMHMtNS4zIDEzLjggMCAxOS4xbDIxNS41IDIxNS41LTIxNS41IDIxNS41Yy01LjMgNS4zLTUuMyAxMy44IDAgMTkuMSAyLjYgMi42IDYuMSA0IDkuNSA0IDMuNCAwIDYuOS0xLjMgOS41LTRsMjI1LjEtMjI1LjFjNS4zLTUuMiA1LjMtMTMuOC4xLTE5eiIvPjwvc3ZnPg==) no-repeat;background-size:contain;position:absolute;top:0;left:0;height:100%;width:100%}}.arrows--horizontal{display:flex;position:relative;margin:0;align-items:flex-start}.arrow__wrapper{display:flex;justify-content:flex-start;align-items:center;margin:0}.arrow__wrapper:first-of-type{border-right:none;z-index:20}.arrow__wrapper:nth-of-type(n+2){margin-left:-4rem;z-index:10}.arrow__wrapper:nth-of-type(n+2) .arrow__rectangle{border-left:none;padding-left:4rem}.arrow__wrapper:nth-of-type(3){z-index:5}.arrow__wrapper:hover .arrow__point,.arrow__wrapper:hover .arrow__rectangle,.arrow__wrapper:hover .arrow__rectangle>a{background-color:#33332d!important;color:#fff!important}.arrow__rectangle{padding:1rem;justify-content:center;align-items:center;border:2px solid #33332d;border-right:none;z-index:2;overflow:hidden;font-family:IBM Plex Sans,monospace;position:relative}@media (max-width:991px){.arrow__rectangle{font-size:.7rem}}.arrow__rectangle .bold{font-weight:600}.arrow__rectangle--thick-border{border:3px solid #33332d;border-right:none}.arrow__point{padding:1.25rem;border:2px solid #33332d;border-bottom:none;border-left:none;-webkit-transform:translate(-1.3rem) rotate(45deg);transform:translate(-1.3rem) rotate(45deg);z-index:1;overflow:hidden}.arrow__point--thick-border{border:3px solid #33332d;border-bottom:none;border-left:none}.arrow__wrapper--stacked{display:flex;justify-content:flex-start;align-items:center;margin:auto auto auto 0}.arrow__wrapper--stacked:nth-of-type(n+2){margin-top:1rem}@media (min-width:640px){.arrow__wrapper--stacked:nth-of-type(n+2){margin-top:-2px}}.arrow__wrapper--stacked .arrow__rectangle{position:relative}@media (min-width:640px){.arrow__wrapper--stacked .arrow__rectangle{padding:1.25rem}}@media (min-width:992px){.arrow__wrapper--stacked .arrow__rectangle{padding:1rem}}.arrow__wrapper--stacked .arrow__point{padding:1.08rem;margin-left:2px}@media (min-width:640px){.arrow__wrapper--stacked .arrow__point{margin-left:unset;padding:1.25rem}}.arrow__wrapper--stacked:hover .arrow__point,.arrow__wrapper--stacked:hover .arrow__rectangle{background-color:#33332d!important}.arrow__wrapper--stacked:hover .arrow--stacked-letter,.arrow__wrapper--stacked:hover .arrow--stacked-title{color:#fff}.arrow--stacked-letter{margin-right:2rem}.arrow--stacked-title{white-space:nowrap;font-family:IBM Plex Mono,monospace}.arrow__container--with-link{width:100%!important}@media (max-width:639px){.breadcrumb .arrow__wrapper{padding:0}.breadcrumb .arrow__wrapper:not(:last-of-type):after{content:">";font-size:.7rem;font-weight:400;margin:0 .5rem}}.breadcrumb .arrow__wrapper:hover .arrow__point,.breadcrumb .arrow__wrapper:hover .arrow__rectangle{background-color:#33332d!important}.breadcrumb .arrow__wrapper:hover .arrow--stacked-letter,.breadcrumb .arrow__wrapper:hover .arrow--stacked-title{color:#fff}.breadcrumb .arrow__rectangle{position:relative}@media (max-width:639px){.breadcrumb .arrow__rectangle{border:none;padding:0;font-size:.7rem;white-space:nowrap;background-color:transparent!important;color:#33332d}}@media (max-width:639px){.breadcrumb .arrow__point{display:none}}.banner{display:flex;width:100%;align-items:center;position:relative;padding:2rem 0;background-color:#e1e1e1}@media (min-width:992px){.banner{padding:3.444rem 3.444rem 4.444rem}}.edit-link{border-bottom-width:3px;border-bottom-style:solid}@media (min-width:992px){#footer{align-items:center}}#footer .footer__navigation-link{font-size:1rem;line-height:18px;white-space:nowrap;font-family:IBM Plex Sans,monospace;margin-left:0!important}#footer .footer__navigation-link:nth-of-type(n+2){margin-top:2.142rem}@media (min-width:992px){#footer .footer__navigation{flex-direction:row;flex-wrap:nowrap;justify-content:flex-end}#footer .footer__navigation-link{margin-top:0!important;margin-bottom:auto}#footer .footer__navigation-link:nth-of-type(n+1){margin-right:2.877rem}#footer .footer__navigation-link:last-of-type{margin-right:0!important}}.prev-next__container .separator{display:none}@media (max-width:639px){.prev-next__container .separator{display:block;background-color:#33332d;width:2px}}.prev-next__container .prev b,.prev-next__container .prev p{text-align:right}@media (max-width:639px){.prev-next__container .prev p:before{content:"<";margin-right:1rem}}@media (max-width:639px){.prev-next__container .next p:after{content:">";margin-left:1rem}}.body-text:not(:last-of-type){margin-bottom:2.5rem}.body-text__title{color:#33332d;font-size:1.44rem;line-height:1.25em;font-weight:700;margin:0;position:relative;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.body-text__content:not(:last-of-type){padding-bottom:2em}.bold{font-weight:700}.body-text--no-padding{padding:0!important}.scroll-navigation{font-size:16px;position:absolute;width:30%;left:0;top:198px;padding-right:1rem;z-index:199}@media (max-width:991px){.scroll-navigation{display:none}}.scroll-navigation li{list-style-type:none}.scroll-navigation li:hover{cursor:pointer}.scroll-navigation li:hover a{background-color:#33332d;color:#fff!important}.scroll-navigation li:before{content:"-"}.left-navigation-link{padding-left:1.2rem;text-indent:-1.2rem}.left-navigation-link:hover{background-color:#33332d!important;color:#fff!important}.level-h1{font-weight:700;padding-left:2.8rem;text-indent:-2.8rem}.level-h2{padding-left:1.6rem;text-indent:-1.6rem}.accordion__container{margin-bottom:1rem}.accordion__title{padding-left:2.149rem!important;padding-right:2.149rem!important;font-size:1.111rem!important;font-weight:600}.accordion{background-color:#fff;border:3px solid #33332d;border-radius:5px;color:#444;cursor:pointer;padding:1rem;width:100%;text-align:left;outline:none;font-size:15px;transition:max-width .4s}.accordion:hover,.active{background-color:#e1e1e1}.accordion:after{content:"\2795";font-size:1rem;float:right;margin-left:5px}.active{border-color:#fff}.active:after{content:"\2796"}.panel{background-color:#fff;transition:height .3s;transition-timing-function:ease-in-out;overflow:hidden}.accordion--side-navigation{width:100%;margin-left:unset}.accordion--side-navigation .accordion{border:none;padding:0!important;background-color:transparent!important;color:#33332d!important;border-radius:0}.accordion--side-navigation .accordion__title{font-size:16px!important;font-weight:unset;background-color:transparent}.accordion--side-navigation .accordion__title:hover{background-color:#33332d!important;color:#fff!important}.accordion--side-navigation .panel{padding:1rem 0 0!important;background-color:transparent}.accordion--side-navigation .panel ul{margin-left:1rem}.accordion--side-navigation .accordion:hover,.accordion--side-navigation .active{background-color:#33332d;color:#fff}.accordion--side-navigation .accordion:after,.accordion--side-navigation .active:after{content:""}.sub-header{color:#33332d;font-family:IBM Plex Mono,monospace;padding-bottom:1.357rem}@media (min-width:992px){.sub-header{padding-bottom:2.333rem}}</style><meta name="generator" content="Gatsby 2.0.53"/><title data-react-helmet="true">Fullstack osa8 |  | Fullstack 2019</title><meta data-react-helmet="true" name="description" content=""/><meta data-react-helmet="true" property="og:title" content="Fullstack osa8 | "/><meta data-react-helmet="true" property="og:description" content=""/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Houston Inc. Consulting oy"/><meta data-react-helmet="true" name="twitter:title" content="Fullstack osa8 | "/><meta data-react-helmet="true" name="twitter:description" content=""/><meta data-react-helmet="true" name="keywords" content="Fullstack, "/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link as="script" rel="preload" href="/app-77e4e50dff4a402760b9.js"/><link as="script" rel="preload" href="/1-072e5cd30afe3d25b43a.js"/><link as="script" rel="preload" href="/component---src-templates-content-template-js-45199be9da0474ef210f.js"/><link as="script" rel="preload" href="/2-8cb475ac5ceeb60d8393.js"/><link as="script" rel="preload" href="/0-87340ba4bd0a15678a60.js"/><link as="script" rel="preload" href="/3-581fe0821230e9175114.js"/><link as="script" rel="preload" href="/webpack-runtime-2ffd64c747c510276057.js"/><link rel="preload" href="/static/d/407/path---osa-8-react-ja-graph-ql-986-8bc-EUrDmdBRAG5T7oEW5L5bROR79oc.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="header " style="background-color:white"><div class="container" style="align-items:center;justify-content:flex-start"><a class="header__logo" href="/"><div class="triple-border nav-item-hover " style="padding:0.2em"><div class="triple-border__container triple-border__logo" style="background-color:transparent">{() =&gt; fs}</div></div></a><div class="navigation__wrapper "><button aria-label="Navigation menu" aria-expanded="false" class="navigation__toggle"><div class="navigation__toggle-icon"></div></button><nav><ul class="navigation"><li class="navigation__item "><a class="nav-item-hover" href="/about">KURSSISTA</a></li><li class="navigation__item "><a class="nav-item-hover" href="/#course-contents">KURSSIN SISÄLTÖ</a></li><li class="navigation__item "><a class="nav-item-hover" href="/faq">FAQ</a></li></ul></nav></div></div></div><div class="course-container spacing--after"><div class="banner " style="background-image:url(/static/part-8-1f98236965546b36c2a293574ec8b02a.svg);background-position:center center;background-size:50%;background-repeat:no-repeat;background-color:#82F7EB"><div class="container spacing--after"><div class="col-10 spacing--after"><div class="arrow__container arrows--horizontal breadcrumb"><div class="arrow__wrapper"><div class="arrow__rectangle  " style="background-color:#82F7EB;color:#33332d"><a href="/#course-contents">Fullstack</a></div><div class="arrow__point " style="background-color:#82F7EB;color:#33332d"></div></div><div class="arrow__wrapper"><div class="arrow__rectangle  " style="background-color:#82F7EB;color:#33332d"><a href="/osa8">osa 8</a></div><div class="arrow__point " style="background-color:#82F7EB;color:#33332d"></div></div><div class="arrow__wrapper"><div class="arrow__rectangle  " style="background-color:#33332d;color:white">React ja GraphQL</div><div class="arrow__point " style="background-color:#33332d;color:white"></div></div></div></div></div></div><div class="course "><div class="container element--flex element--relative"><div class="scroll-navigation col-2 spacing element--flex element--column" tag="ul"><a class="left-navigation-link" style="border-color:#82F7EB" href="/osa8/graph_ql_palvelin">a GraphQL-palvelin</a><div class="accordion__container col-8 push-right-1 accordion--side-navigation"><button class="accordion accordion__title  " style="background-color:#82F7EB;border-color:#82F7EB">b React ja GraphQL</button><div class="panel" style="padding:;max-height:0;transition:max-height 0.2s ease-out"><ul></ul></div></div><a class="left-navigation-link" style="border-color:#82F7EB" href="/osa8/tietokanta_ja_kayttajien_hallinta">c Tietokanta ja käyttäjien hallinta</a><a class="left-navigation-link" style="border-color:#82F7EB" href="/osa8/kirjautuminen_ja_valimuistin_paivitys">d Kirjautuminen ja välimuistin päivitys</a><a class="left-navigation-link" style="border-color:#82F7EB" href="/osa8/fragmentit_ja_subskriptiot">e Fragmentit ja subskriptiot</a></div><div class="course-content col-6 push-right-3 element--auto-bottom-margin"><p class="col-1 letter" style="border-color:#82F7EB">b</p><h1 class="sub-header ">React ja GraphQL</h1></div></div><div class="container"><div class="course-content col-6 push-right-3">
<p>Toteutetaan seuraavaksi React-sovellus, joka käyttää toteuttamaamme GraphQL-palvelinta. </p>
<p>GraphQL:ää on periaatteessa mahdollista käyttää HTTP POST -pyyntöjen avulla. Seuraavassa esimerkki Postmanilla tehdystä kyselystä</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/70a60c28934e97ddcae170c6ab488138/14be6/8.png"/></picture>
<p>Kommunikointi siis tapahtuu osoitteeseen <a href="http://localhosto:4000/graphql">http://localhosto:4000/graphql</a> kohdistuvina POST-pyyntöinä, ja itse kysely lähetetään pyynnön mukana merkkijonona avaimen <i>query</i> arvona. </p>
<p>Voisimmekin hoitaa React-sovelluksen ja GraphQL:n kommunikoinnin Axiosilla. Tämä ei kuitenkaan ole useimmiten järkevää ja on parempi idea käyttää korkeamman tason kirjastoa, joka pystyy abstrahoimaan kommunikoinnin turhia detaljeja. Tällä hetkellä järkeviä vaihtoehtoja on kaksi, Facebookin <a href="https://facebook.github.io/relay/">Relay</a> ja
<a href="https://www.apollographql.com/docs/react/">Apollo Client</a>, näistä Apollo on ylivoimaisesti suositumpi ja myös meidän valintamme.</p>
<h3>Apollo client</h3>
<p>Luodaan uusi React-sovellus ja asennetaan siihen <a href="https://www.apollographql.com/docs/react/essentials/get-started.html#installation">Apollo clientin</a> vaatimat riippuvuudet</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">npm install apollo<span class="token operator">-</span>boost react<span class="token operator">-</span>apollo graphql <span class="token operator">--</span>save</code></pre></div>
<p>Aloitetaan seuraavalla ohjelmarungolla</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&#x27;react-dom&#x27;</span>

<span class="token keyword">import</span> ApolloClient<span class="token punctuation">,</span> <span class="token punctuation">{</span> gql <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;apollo-boost&#x27;</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  uri<span class="token punctuation">:</span> <span class="token string">&#x27;http://localhost:4000/graphql&#x27;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> query <span class="token operator">=</span> gql<span class="token template-string"><span class="token string">`
{
  allPersons  {
    name,
    phone,
    address {
      street, city
    }
    id
  }
}
`</span></span>

client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    test
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;root&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>Koodi aloittaa luomalla <a href="https://www.apollographql.com/docs/react/essentials/get-started.html#creating-client">client</a>-olion, jonka avulla se lähettää kyselyn palvelimelle:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Palvelimen palauttama vastaus tulostuu konsoliin:</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/dc57bab4b03027308b958e6271cfc1bb/14be6/9a.png"/></picture>
<p>Sovelluksen siis pystyy kommunikoimaan GraphQL-palvelimen kanssa olion <em>client</em> välityksellä. Client saadaan sovelluksen kaikkien komponenttien saataville käärimällä komponenttti <i>App</i> komponentin <a href="https://www.apollographql.com/docs/react/essentials/get-started.html#creating-provider">ApolloProvider</a> lapseksi:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&#x27;react-dom&#x27;</span>
<span class="gatsby-highlight-code-line"><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#x27;./App&#x27;</span></span><span class="token keyword">import</span> ApolloClient<span class="token punctuation">,</span> <span class="token punctuation">{</span> gql <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;apollo-boost&#x27;</span>
<span class="gatsby-highlight-code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-apollo&#x27;</span></span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  uri<span class="token punctuation">:</span> <span class="token string">&#x27;http://localhost:4000/graphql&#x27;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">  <span class="token operator">&lt;</span>ApolloProvider client<span class="token operator">=</span><span class="token punctuation">{</span>client<span class="token punctuation">}</span> <span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">  <span class="token operator">&lt;</span><span class="token operator">/</span>ApolloProvider<span class="token operator">&gt;</span><span class="token punctuation">,</span> </span>  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;root&#x27;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre></div>
<h3>Query-komponentti</h3>
<p>Olemme valmiina toteuttamaan sovelluksen päänäkymän, joka listaa kaikkien henkilöiden puhelinnumerot. </p>
<p>Apollo Client tarjoaa muutaman vaihtoehtoisen tavan kyselyjen tekemiselle.
Tämän hetken (tämä osa on kirjoitettu 17.2.2019) vallitseva käytäntö on komponentin <a href="https://www.apollographql.com/docs/react/essentials/queries.html">Query</a> käyttäminen.</p>
<p>Kyselyn tekevän komponentin <i>App</i> koodi näyttää seuraavalta:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Query <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-apollo&#x27;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> gql <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;apollo-boost&#x27;</span>

<span class="token keyword">const</span> <span class="token constant">ALL_PERSONS</span> <span class="token operator">=</span> gql<span class="token template-string"><span class="token string">`
{
  allPersons  {
    name
    phone
    id
  }
}
`</span></span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Query query<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">ALL_PERSONS</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
      <span class="token keyword">if</span> <span class="token punctuation">(</span> result<span class="token punctuation">.</span>loading <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>allPersons<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#x27;, &#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Query<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre></div>
<p>Koodi vaikuttaa hieman sekavalta. Koodin ytimessä on komponentti <i>Query</i>, joka saa parametrina <i>query</i> suoritettavan kyselyn joka on muuttujassa <em>ALL_PERSONS</em>. Komponentin <i>Query</i> tagien sisällä on <i>funktio</i>, joka palauttaa varsinaisen renderöitävän JSX:n. Funktion parametri <i>results</i> sisältää GraphQL-kyselyn tuloksen.</p>
<p>Tuloksella eli parametrissa <em>results</em> olevalla oliolla on <a href="https://www.apollographql.com/docs/react/essentials/queries.html#render-prop">useita kenttiä</a>. Kenttä <i>loading</i> on arvoltaan tosi, jos kyselyyn ei ole saatu vielä vastausta. Tässä tilanteessa renderöitävä koodi on </p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span> result<span class="token punctuation">.</span>loading <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Kun tulos on valmis, otetaan tuloksen kentästä <i>data</i> kyselyn <i>allPersons</i> vastaus ja renderöidään luettelossa olevat nimet ruudulle</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">{</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>allPersons<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#x27;, &#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code></pre></div>
<p>Saadaksemme ratkaisua hieman siistimmäksi eriytetään henkilöiden näyttäminen omaan komponenttiin <i>Persons</i>. Komponentti <i>App</i> muuttuu seuraavasti</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Query query<span class="token operator">=</span><span class="token punctuation">{</span>allPersons<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Persons result<span class="token operator">=</span><span class="token punctuation">{</span>result<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Query<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Eli <i>App</i> välittää kyselyn tuloksen komponentille <i>Persons</i> propsina:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">Persons</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> result <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>loading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> persons <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>allPersons 

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Persons<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>persons<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span>
        <span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">{</span>p<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>p<span class="token punctuation">.</span>name<span class="token punctuation">}</span> <span class="token punctuation">{</span>p<span class="token punctuation">.</span>phone<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>  
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>Nimetyt kyselyt ja muuttujat</h3>
<p>Toteutetaan sovellukseen ominaisuus, jonka avulla on mahdollisuus nähdä yksittäisen henkilön osoitetiedot. Palvelimen tarjoama kysely <i>findPerson</i> sopii hyvin tarkoitukseen. </p>
<p>Edellisessä luvussa tekemissämme kyselyissä parametri oli kovakoodattuna kyselyyn:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">query <span class="token punctuation">{</span>
  <span class="token function">findPerson</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">&quot;Arto Hellas&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    phone 
    city 
    street
    id
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Kun teemme kyselyjä ohjelmallisesti, on kyselyn parametrit pystyttävä antamaan dynaamisesti. </p>
<p>Tähän tarkoitukseen sopivat GraphQL:n <a href="https://graphql.org/learn/queries/#variables">muuttujat</a>. Muuttujia käyttääksemme on kysely myös nimettävä.</p>
<p>Sopiva muoto kyselylle on seuraava:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">query <span class="token function">findPersonByName</span><span class="token punctuation">(</span>$nameToSearch<span class="token punctuation">:</span> String<span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">findPerson</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> $nameToSearch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  name
    phone 
    address<span class="token punctuation">{</span>
      street
      city
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Kyselyn nimenä on <i>findPersonByName</i>, ja se saa yhden merkkijonomuotoisen parametrin <i>$nameToSearch</i>. </p>
<p>Myös GraphQL Playground mahdollistaa muuttujia sisältävän kyselyjen tekemisen. Tällöin muuttujille on annettava arvot kohdassa <i>Query variables</i>:</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/db68c3eeadc2cf4514b6ebc38025c5c1/14be6/10.png"/></picture>
<p>Äsken käyttämämme komponentti <i>Query</i> ei sovellu optimaalisella tavalla tarkoitukseen sillä haluaisimme tehdä kyselyn vasta siinä vaiheessa kun käyttäjä haluaa nähdä jonkin henkilön tiedot. </p>
<p>Eräs tapa on käyttää suoraan <i>client</i> olion metodia <i>query</i>. Sovelluksen komponentit pääsevät käsiksi query-olioon komponentin <a href="https://www.apollographql.com/docs/react/essentials/queries.html#manual-query">ApolloConsumer</a> avulla.</p>
<p>Muutetaan komponenttia <i>App</i> siten, että hakee <i>ApolloConsumerin</i> avulla viitteen <em>query</em>-olioon ja välittää sen komponentille <i>Persons</i></p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="gatsby-highlight-code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Query<span class="token punctuation">,</span> ApolloConsumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-apollo&#x27;</span></span>
<span class="token comment">// ...</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ApolloConsumer<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span><span class="token punctuation">(</span>client <span class="token operator">=&gt;</span> 
        <span class="token operator">&lt;</span>Query query<span class="token operator">=</span><span class="token punctuation">{</span>allPersons<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
            <span class="token operator">&lt;</span>Persons result<span class="token operator">=</span><span class="token punctuation">{</span>result<span class="token punctuation">}</span> client<span class="token operator">=</span><span class="token punctuation">{</span>client<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span> 
          <span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Query<span class="token operator">&gt;</span> 
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ApolloConsumer<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Komponentti <i>Persons</i> muuttuu seuraavasti</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="gatsby-highlight-code-line"><span class="token keyword">const</span> <span class="token constant">FIND_PERSON</span> <span class="token operator">=</span> gql<span class="token template-string"><span class="token string">`</span><span class="gatsby-highlight-code-line">query findPersonByName($nameToSearch: String!) {</span><span class="gatsby-highlight-code-line">  findPerson(name: $nameToSearch) {</span><span class="gatsby-highlight-code-line">    name</span><span class="gatsby-highlight-code-line">    phone </span><span class="gatsby-highlight-code-line">    id</span><span class="gatsby-highlight-code-line">    address{</span><span class="gatsby-highlight-code-line">      street</span><span class="gatsby-highlight-code-line">      city</span><span class="gatsby-highlight-code-line">    }</span><span class="gatsby-highlight-code-line">  }</span><span class="gatsby-highlight-code-line">}</span><span class="gatsby-highlight-code-line">`</span></span></span>
<span class="token keyword">const</span> <span class="token function-variable function">Persons</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> result<span class="token punctuation">,</span> client <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>loading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>

<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>person<span class="token punctuation">,</span> setPerson<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> showPerson <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      query<span class="token punctuation">:</span> <span class="token constant">FIND_PERSON</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      variables<span class="token punctuation">:</span> <span class="token punctuation">{</span> nameToSearch<span class="token punctuation">:</span> name <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token function">setPerson</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>findPerson<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span><span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span><span class="token punctuation">{</span>person<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>person<span class="token punctuation">.</span>address<span class="token punctuation">.</span>street<span class="token punctuation">}</span> <span class="token punctuation">{</span>person<span class="token punctuation">.</span>address<span class="token punctuation">.</span>city<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>person<span class="token punctuation">.</span>phone<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setPerson</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>close<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Persons<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>allPersons<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span>
        <span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">{</span>p<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>p<span class="token punctuation">.</span>name<span class="token punctuation">}</span> <span class="token punctuation">{</span>p<span class="token punctuation">.</span>phone<span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line">          <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">showPerson</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">            show address</span><span class="gatsby-highlight-code-line">          <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span> </span>        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>  
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Jos henkilön yhteydessä olevaa nappia painetaan, tekee komponentti GraphQL-kyselyn henkilön tiedoista ja tallettaa vastauksen komponentin tilaan <i>person</i>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> showPerson <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    query<span class="token punctuation">:</span> <span class="token constant">FIND_PERSON</span><span class="token punctuation">,</span>
    variables<span class="token punctuation">:</span> <span class="token punctuation">{</span> nameToSearch<span class="token punctuation">:</span> name <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">setPerson</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>findPerson<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Jos tilalla <em>person</em> on arvo näytetään kaikkien henkilöiden sijaan yhden henkilön tarkemmat tiedot:</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/6092f1af8a93fbe11fc40b7ab708eec0/14be6/11.png"/></picture>
<p>Ratkaisu ei ole siistein mahdollinen mutta saa kelvata meille.</p>
<p>Sovelluksen tämänhetkinen koodi on kokonaisuudessaan <a href="https://github.com/fullstack-hy2019/graphql-phonebook-frontend/tree/part8-1">githubissa</a>, branchissa <i>part8-1</i>.</p>
<h3>Välimuisti</h3>
<p>Kun haemme monta kertaa esim. Arto Hellaksen tiedot huomaamme mielenkinntoisen asian. Kysely backendiin tapahtuu ainoastaan tietojen ensimmäisellä katsomiskerralla, tämän jälkeen siitäkin huomiatta, että koodi tekee saman kysely uudelleen, ei kyselyä lähetetä backendille:</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/2393546b9b6db7605511693321439519/14be6/12.png"/></picture>
<p>Apollo client tallettaa kyselyjen tulokset cacheen eli <a href="https://www.apollographql.com/docs/react/advanced/caching.html">välimuistiin</a> ja optimoi suoritusta siten, että jos kyselyn vastaus on jo välimuistissa, ei kyselyä lähetetä ollenkaan palvelimelle.</p>
<p>Chromeen on mahdollista asentaa lisäosa <a href="https://chrome.google.com/webstore/detail/apollo-client-developer-t/jdkknkkbebbapilgoeccciglkfbmbnfm/related">Apollo Client devtools</a>, jonka avulla voidaan tarkastella mm. välimuistin tilaa</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/c69cc11572b1f3bcf1a5ca2dc8bc32bf/14be6/13a.png"/></picture>
<p>Tieto on organisoitu välimuistiin kyselykohtaisesti. Koska <i>Person</i>-tyypin olioilla on identifioiva kenttä <i>id</i>, jonka tyypiksi on määritelty <i>ID</i> osaa Apollo yhdistää kahden eri kyselyn palauttaman saman olion. Tämän ansiosta Arto Hellaksen osoitetietojen hakeminen kyselyllä <i>findPerson</i> on päivittänyt välimuistia Arton osoitetietojen osalta myös kyselyn <i>allPersons</i> alta.</p>
<h3>Mutation-komponentti</h3>
<p>Toteutetaan sovellukseen mahdollisuus uusien henkilöiden lisäämiseen. Sopivan toiminnallisuuden tarjoaa komponentti <a href="https://www.apollographql.com/docs/react/essentials/mutations.html#basic">mutation</a>. Edellisessä luvussa kovakoodasimme mutaatioiden parametrit. Tarvitsemme nyt <a href="https://graphql.org/learn/queries/#variables">muuttujia</a> käyttävän version henkilön lisäävästä mutaatiosta:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token constant">CREATE_PERSON</span> <span class="token operator">=</span> gql<span class="token template-string"><span class="token string">`
mutation createPerson($name: String!, $street: String!, $city: String!, $phone: String) {
  addPerson(
    name: $name,
    street: $street,
    city: $city,
    phone: $phone
  ) {
    name
    phone
    id
    address {
      street
      city
    }
  }
}
`</span></span></code></pre></div>
<p>Komponentti <i>App</i> muuttuu seuraavasti</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>ApolloConsumer<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
          <span class="token operator">&lt;</span>Query query<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">ALL_PERSONS</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
              <span class="token operator">&lt;</span>Persons result<span class="token operator">=</span><span class="token punctuation">{</span>result<span class="token punctuation">}</span> client<span class="token operator">=</span><span class="token punctuation">{</span>client<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Query<span class="token operator">&gt;</span> 
        <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ApolloConsumer<span class="token operator">&gt;</span>
<span class="gatsby-highlight-code-line">      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>create <span class="token keyword">new</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">      <span class="token operator">&lt;</span>Mutation mutation<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">CREATE_PERSON</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">{</span><span class="token punctuation">(</span>addPerson<span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span><span class="gatsby-highlight-code-line">          <span class="token operator">&lt;</span>PersonForm</span><span class="gatsby-highlight-code-line">            addUser<span class="token operator">=</span><span class="token punctuation">{</span>addPerson<span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">          <span class="token operator">/</span><span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">      <span class="token operator">&lt;</span><span class="token operator">/</span>Mutation<span class="token operator">&gt;</span></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Komponentin <i>Mutation</i> tagien sisällä on <i>funktio</i>, joka palauttaa varsinaisen renderöitävän lomakkeen muodostaman komponentin <i>PersonForm</i>. Parametrina tuleva <i>addPerson</i> on funktio, jota kutsumalla mutaatio suoritetaan.</p>
<p>Lomakkeen muodostama komponentti ei sisällä mitään ihmeellistä</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">PersonForm</span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>phone<span class="token punctuation">,</span> setPhone<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>street<span class="token punctuation">,</span> setStreet<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>city<span class="token punctuation">,</span> setCity<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> submit <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> props<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      variables<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> street<span class="token punctuation">,</span> city <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
    <span class="token function">setPhone</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
    <span class="token function">setStreet</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
    <span class="token function">setCity</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>submit<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          name <span class="token operator">&lt;</span>input
            value<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> target <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setName</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          phone <span class="token operator">&lt;</span>input
            value<span class="token operator">=</span><span class="token punctuation">{</span>phone<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> target <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setPhone</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          street <span class="token operator">&lt;</span>input
            value<span class="token operator">=</span><span class="token punctuation">{</span>street<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> target <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setStreet</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          city <span class="token operator">&lt;</span>input
            value<span class="token operator">=</span><span class="token punctuation">{</span>city<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> target <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCity</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">&#x27;submit&#x27;</span><span class="token operator">&gt;</span>add<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Lisäys kyllä toimii, mutta sovelluksen näkymä ei päivity. Syynä tälle on se, että Apollo Client ei osaa automaattisesti päivittää sovelluksen välimuistia, se sisältää edelleen ennen lisäystä olevan tilanteen. Saisimme kyllä uuden käyttäjän näkyviin uudelleenlataamalla selaimen, sillä Apollon välimuiti nollautuu uudelleenlatauksen yhteydessä. Tilanteeseen on kuitenkin pakko löytää joku järkevämpi ratkaisu.</p>
<h3>Välimuistin päivitys</h3>
<p>Ongelma voidaan ratkaista muutamallakin eri tavalla. Eräs tapa on määritellä kaikki henkilöt hakeva kysely <a href="https://www.apollographql.com/docs/react/essentials/queries.html#refetching">pollaamaan</a> palvelinta, eli suorittamaan kysely palvelimelle toistuvasti tietyin väliajoin. </p>
<p>Muutos on pieni, määritellään pollausväliksi kaksi sekuntia:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>ApolloConsumer<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
<span class="gatsby-highlight-code-line">          <span class="token operator">&lt;</span>Query query<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">ALL_PERSONS</span><span class="token punctuation">}</span> pollInterval<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2000</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span>            <span class="token punctuation">{</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
              <span class="token operator">&lt;</span>Persons result<span class="token operator">=</span><span class="token punctuation">{</span>result<span class="token punctuation">}</span> client<span class="token operator">=</span><span class="token punctuation">{</span>client<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Query<span class="token operator">&gt;</span> 
        <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ApolloConsumer<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>create <span class="token keyword">new</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Mutation mutation<span class="token operator">=</span><span class="token punctuation">{</span>createPerson<span class="token punctuation">}</span> <span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token punctuation">(</span>addPerson<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
          <span class="token operator">&lt;</span>PersonForm
            addUser<span class="token operator">=</span><span class="token punctuation">{</span>addPerson<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Mutation<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Yksinkertaisuuden lisäksi ratkaisun hyvä puoli on se, että aina kun joku käyttäjä lisää palvelimelle uuden henkilön, se ilmestyy pollauksen ansiosta heti kaikkien sovelluksen käyttäjien selaimeen.</p>
<p>Ikävänä puolena pollauksessa on tietenkin sen aiheuttama turha verkkoliikenne.</p>
<p>Toinen helppo tapa välimuistin synkronoimiseen on määritellä <i>Mutation</i>-komponentin <a href="https://www.apollographql.com/docs/react/essentials/mutations.html#props">refetchQueries</a>-propsin avulla että kysely <i>ALL_PERSONS</i> tulee suorittaa uudelleen henkilön lisäyksen yhteydessä:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>ApolloConsumer<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
          <span class="token operator">&lt;</span>Query query<span class="token operator">=</span><span class="token punctuation">{</span>allPersons<span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
              <span class="token operator">&lt;</span>Persons result<span class="token operator">=</span><span class="token punctuation">{</span>result<span class="token punctuation">}</span> client<span class="token operator">=</span><span class="token punctuation">{</span>client<span class="token punctuation">}</span> 
            <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Query<span class="token operator">&gt;</span> 
        <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ApolloConsumer<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>create <span class="token keyword">new</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Mutation
        mutation<span class="token operator">=</span><span class="token punctuation">{</span>createPerson<span class="token punctuation">}</span> 
<span class="gatsby-highlight-code-line">        refetchQueries<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">{</span> query<span class="token punctuation">:</span> <span class="token constant">ALL_PERSONS</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>      <span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token punctuation">(</span>addPerson<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
          <span class="token operator">&lt;</span>PersonForm
            addUser<span class="token operator">=</span><span class="token punctuation">{</span>addPerson<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Mutation<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Edut ja haitat tällä ratkaisulla ovat melkeimpä päinvastauset pollaukseen. Verkkoliikennettä ei synny kuin tarpeen vaatiessa, eli kyselyjä ei tehdä varalta. Jos joku muu käyttäjä päivittää palvelimen tilaa, muutokset eivät kuitenkaan siirry nyt kaikille käyttäjille.</p>
<p>Muitakin tapoja välimuistin tilan päivittämiseksi on, niistä lisää myöhemmin tässä osassa.</p>
<p><strong>HUOM</strong> Apollo Client devtools vaikuttaa olevan hieman buginen, se lopettaa jossain vaiheessa välimuistin tilan päivittämisen. Jos törmäät ongelmaan avaa sovellus uudessa välilehdessä.</p>
<p>Sovelluksen tämänhetkinen koodi on kokonaisuudessaan <a href="https://github.com/fullstack-hy2019/graphql-phonebook-frontend/tree/part8-2">githubissa</a>, branchissa <i>part8-2</i>.</p>
<h4>Mutaatioiden virheiden käsittely</h4>
<p>Jos yritämme luoda epävalidia henkilöä, seurauksena on poikkeus</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/847c81eecdb5b3da531826566eeb9517/14be6/14.png"/></picture>
<p>Poikkeus on syytä käsitellä. Eräs tapa poikkeusten käsittelyyn on rekisteröidä mutaatiolle poikkeuksenkäsittelijä <a href="https://www.apollographql.com/docs/react/essentials/mutations.html#props">onError</a>-propsin avulla:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>errorMessage<span class="token punctuation">,</span> setErrorMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> <span class="token function-variable function">handleError</span> <span class="token operator">=</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token function">setErrorMessage</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>graphQLErrors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      <span class="token function">setErrorMessage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
<span class="gatsby-highlight-code-line">      <span class="token punctuation">{</span>errorMessage<span class="token operator">&amp;&amp;</span></span><span class="gatsby-highlight-code-line">        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>color<span class="token punctuation">:</span> <span class="token string">&#x27;red&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">          <span class="token punctuation">{</span>errorMessage<span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span></span>      <span class="token operator">&lt;</span>ApolloConsumer<span class="token operator">&gt;</span>
        <span class="token comment">// ...</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ApolloConsumer<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>create <span class="token keyword">new</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Mutation
        mutation<span class="token operator">=</span><span class="token punctuation">{</span>createPerson<span class="token punctuation">}</span> 
        refetchQueries<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">{</span> query<span class="token punctuation">:</span> allPersons <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line">        onError<span class="token operator">=</span><span class="token punctuation">{</span>handleError<span class="token punctuation">}</span></span>      <span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token punctuation">(</span>addPerson<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
          <span class="token operator">&lt;</span>PersonForm
            addUser<span class="token operator">=</span><span class="token punctuation">{</span>addPerson<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Mutation<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Poikkeukesta tiedotetaan nyt käyttäjää yksinkertaisella notifikaatiolla</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/e1e096a90a3b8783af211703c5088439/14be6/15.png"/></picture>
<p>Sovelluksen tämänhetkinen koodi on kokonaisuudessaan <a href="https://github.com/fullstack-hy2019/graphql-phonebook-frontend/tree/part8-3">githubissa</a>, branchissa <i>part8-3</i>.</p>
<h3>Puhelinnumeron päivitys</h3>
<p>Tehdään sovellukseen mahdollisuus vaihtaa henkilöiden puheninnumeroita. Ratkaisu on lähes samanlainen kuin uuden henkilön lisäykseen käytetty.</p>
<p>Mutaatio edellyttää jälleen muuttujien käyttöä</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token constant">EDIT_NUMBER</span> <span class="token operator">=</span> gql<span class="token template-string"><span class="token string">`
mutation editNumber($name: String!, $phone: String!) {
  editNumber(name: $name, phone: $phone)  {
    name
    phone
    address {
      street
      city
    }
    id
  }
}
`</span></span></code></pre></div>
<p>Tehdään lisäys <i>App</i>-komponentiin:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>errorMessage <span class="token operator">&amp;&amp;</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>ApolloConsumer<span class="token operator">&gt;</span>
        <span class="token comment">// ...</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ApolloConsumer<span class="token operator">&gt;</span>
      
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>create <span class="token keyword">new</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Mutation mutation<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">CREATE_PERSON</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token comment">// ...</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Mutation<span class="token operator">&gt;</span>

<span class="gatsby-highlight-code-line">      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>change number<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">      <span class="token operator">&lt;</span>Mutation</span><span class="gatsby-highlight-code-line">        mutation<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">EDIT_NUMBER</span><span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">      <span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">{</span><span class="token punctuation">(</span>editNumber<span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span><span class="gatsby-highlight-code-line">          <span class="token operator">&lt;</span>PhoneForm</span><span class="gatsby-highlight-code-line">            editNumber<span class="token operator">=</span><span class="token punctuation">{</span>editNumber<span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">          <span class="token operator">/</span><span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">      <span class="token operator">&lt;</span><span class="token operator">/</span>Mutation<span class="token operator">&gt;</span>   </span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Muutoksen suorittava komponentti <i>PhoneForm</i> on suoriaviivainen, se kysyy lomakkeen avulla henkilön nimeä ja uutta puhelinnumeroa, ja kutsuu mutaation tekevää funktiota <em>editNumber</em>:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">PersonForm</span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>phone<span class="token punctuation">,</span> setPhone<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> submit <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">await</span> props<span class="token punctuation">.</span><span class="token function">editNumber</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      variables<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> phone <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
    <span class="token function">setPhone</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>submit<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          name <span class="token operator">&lt;</span>input
            value<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> target <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setName</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          phone <span class="token operator">&lt;</span>input
            value<span class="token operator">=</span><span class="token punctuation">{</span>phone<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> target <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setPhone</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">&#x27;submit&#x27;</span><span class="token operator">&gt;</span>change number<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Ulkoasu on karu mutta toimiva:</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/43b4ec44f92a0cabc388c552e309ddfc/14be6/22a.png"/></picture>
<p>Kun numero muutetaan, päivittyy se hieman yllättäen automaattisesti komponentin <i>Persons</i> renderöimään nimien ja numeroiden listaan. Tämä johtuu kahdesta seikasta. Ensinnäkin koska henkilöillä on identifioiva, tyyppiä <i>ID</i> oleva kenttä, päivittyy henkilö välimustissa uusilla tiedoilla päivitysoperaation yhteydessä. Toinen syy näkymän päivittymiselle on se, että komponentin <i>Query</i> avulla tehdyn kyselyn palauttama data huomaa välimuistiin tulleet muutokset ja päivittää itsensä automaattisesti. Tämä koskee ainoastaan kyselyn alunperin palauttamia olioita, ei välimuistiin lisättäviä kokonaan uusia olioita, jotka uudelleen tehtävä kysely palauttaisi.</p>
<p>Jos yritämme vaihtaa olemattomaan nimeen liittyvän puhelinnumeron ei mitään näytä tapahtuvan. Syynä tälle on se, että jos nimeä vastaavaa henkilöä ei löydy, vastataan kyselyyn <i>null</i>:</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/589acbc371dc6e267ba33b4534a49f2f/14be6/23.png"/></picture>
<p>Sovelluksen tämänhetkinen koodi on kokonaisuudessaan <a href="https://github.com/fullstack-hy2019/graphql-phonebook-frontend/tree/part8-4">githubissa</a>, branchissa <i>part8-4</i>.</p>
<h3>Apollo Client ja sovelluksen tila</h3>
<p>Esimerkissämme sovelluksen tilan käsittely on siirtynyt suurimmaksi osaksi Apollo Clientin vastuulle. Tämä onkin melko tyypillinen ratkaisu GraphQL-sovelluksissa. Esimerkkimme käyttää Reactin komponenttien tilaa ainoastaan lomakkeen tilan hallintaan sekä virhetilanteesta kertovan notifikaation näyttämiseen. GraphQL:ää käyttäessä voikin olla, että ei ole enää kovin perusteltuja syitä siirtää sovelluksen tilaa ollenkaan Reduxiin. </p>
<p>Apollo mahdollistaa tarvittaessa myös sovelluksen paikallisen tilan tallettamisen <a href="https://www.apollographql.com/docs/react/essentials/local-state.html">Apollon välimuistiin</a>.</p>
<h3>Render props</h3>
<p>GraphQL:n <i>Query</i>, <i>Mutation</i> ja <i>ApolloConsumer</i> komponentit noudattavat periaatetta, joka kulkee nimellä <a href="https://reactjs.org/docs/render-props.html">render props</a>. Periaatetta noudattava komponentti saa propsina tai tagiensa välissä lapsina (joka on teknisesti ottaen myös props) <i>funktion</i>, joka määrittelee miten komponentin renderöinti tapahtuu. Render props -periaatten avulla on mahdollista siirtää renderöinnistä huolehtivalle komponentille joko dataa tai funktioviitteitä.</p>
<p>Render props -periaate on ollut viime aikoina melko suosittu, mm. osassa 7 käsittelemämme <a href="/osa7/react_router">react router</a> käyttää sitä. React routerin komponentin <i>Route</i> avulla määritellään mitä sovellus renderöi selaimen ollessa tietyssä urlissa. Seuraavassa määritellään, että jos selaimen url on <i>/notes</i> renderöidään komponentti <i>Notes</i>, jos taas selaimen url on esim. <i>/notes/10</i> renderöidään komponentti <i>Note</i> joka saa propsina muistiinpano-olion, jonka id on 10</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token operator">&lt;</span>Router<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token comment">// ...</span>
    <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">&#x27;/notes&#x27;</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
      <span class="token operator">&lt;</span>Notes notes<span class="token operator">=</span><span class="token punctuation">{</span>notes<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>    
    <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">&#x27;/notes/:id&#x27;</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> match <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      <span class="token operator">&lt;</span>Note note<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">noteById</span><span class="token punctuation">(</span>match<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">&gt;</span></code></pre></div>
<p>Urleja vastaavat komponentit on määritelty render propseina. Render props -funktion avulla renderöitävälle komponentille on mahdollista välittää tietoa, esim. yksittäisen muistiinpanon sivu saa propsina urliaan vastaavan muistiinpanon.</p>
<p>Itse en ole suuri render propsien fani. React routerin yhteydessä ne vielä menettelevät mutta erityisesti GraphQL:n yhteydessä niiden käyttö tuntuu erittäin ikävältä. </p>
<p>Joudumme esimerkissämme käärimään komponentin <i>Persons</i> ikävästi kahden render props -komponentin sisälle:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token operator">&lt;</span>ApolloConsumer<span class="token operator">&gt;</span>
  <span class="token punctuation">{</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    <span class="token operator">&lt;</span>Query query<span class="token operator">=</span><span class="token punctuation">{</span>allPersons<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Persons result<span class="token operator">=</span><span class="token punctuation">{</span>result<span class="token punctuation">}</span> client<span class="token operator">=</span><span class="token punctuation">{</span>client<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Query<span class="token operator">&gt;</span> 
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ApolloConsumer<span class="token operator">&gt;</span></code></pre></div>
<p>Muutaman kuukauden kuluessa asiaan on kuitenkin odotettavissa muutoksia ja Apollo Clientiin tullaan lisäämään rajapinta, jonka avulla kyselyjä ja mutaatioita on mahdollista tehdä <a href="https://github.com/apollographql/react-apollo/issues/2539">hookien avulla</a>. </p>
<p>Yleisemminkin trendinä on se, että hookeilla tullaan useissa tapauksissa korvaamaan tarve render propsien käyttöön.</p>
<h3>react-apollo-hooks</h3>
<p>Jo tällä hetkellä on olemassa kirjasto <a href="https://github.com/trojanowski/react-apollo-hooks">react-apollo-hooks</a>, joka mahdollistaa Apollo clientin käytön hookien avulla. Asennetaan kirjasto</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js">npm install <span class="token operator">--</span>save react<span class="token operator">-</span>apollo<span class="token operator">-</span>hooks</code></pre></div>
<p>Otetaan nyt apollo-hookit käyttöön sovelluksessa. Muutetaan <i>index.js</i> ensin muotoon, joka mahdollistaa yhtäaikaisen hookien ja Query- sekä Mutation-komponenttien käytön:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> ApolloClient <span class="token keyword">from</span> <span class="token string">&#x27;apollo-boost&#x27;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-apollo&#x27;</span>
<span class="gatsby-highlight-code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloProvider <span class="token keyword">as</span> ApolloHooksProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-apollo-hooks&#x27;</span></span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  uri<span class="token punctuation">:</span> <span class="token string">&#x27;http://localhost:4000/graphql&#x27;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>ApolloProvider client<span class="token operator">=</span><span class="token punctuation">{</span>client<span class="token punctuation">}</span><span class="token operator">&gt;</span>
<span class="gatsby-highlight-code-line">    <span class="token operator">&lt;</span>ApolloHooksProvider client<span class="token operator">=</span><span class="token punctuation">{</span>client<span class="token punctuation">}</span><span class="token operator">&gt;</span></span>      <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="gatsby-highlight-code-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>ApolloHooksProvider<span class="token operator">&gt;</span></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>ApolloProvider<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;root&#x27;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre></div>
<p>Muutetaan komponenttia <i>Persons</i> siten, että se käyttää <em>useApolloClient</em>-hookia </p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span>  <span class="token punctuation">{</span>useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> gql <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;apollo-boost&#x27;</span>
<span class="gatsby-highlight-code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useApolloClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-apollo-hooks&#x27;</span></span>
<span class="token comment">// ...</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> <span class="token function-variable function">Persons</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> result <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token function">useApolloClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Komponentti <i>App</i> ykseinkertaistuu, render props -komponentti <i>ApolloConsumer</i> voidaan poistaa:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">return</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>errorMessage <span class="token operator">&amp;&amp;</span>
        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">&#x27;red&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>errorMessage<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line">      <span class="token operator">&lt;</span>Query query<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">ALL_PERSONS</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">{</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Persons result<span class="token operator">=</span><span class="token punctuation">{</span>result<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">      <span class="token operator">&lt;</span><span class="token operator">/</span>Query<span class="token operator">&gt;</span> </span>      <span class="token comment">// ...</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Hankkiudutaan seruaavaksi eroon komponentista <i>Query</i> hookin <em>useQuery</em> avulla. Komponentti <i>App</i> yksinkertaistuu edelleen:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="gatsby-highlight-code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useQuery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-apollo-hooks&#x27;</span></span>
<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token constant">ALL_PERSONS</span><span class="token punctuation">)</span></span>
  <span class="token comment">// ...</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>errorMessage <span class="token operator">&amp;&amp;</span>
        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">&#x27;red&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>errorMessage<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>

<span class="gatsby-highlight-code-line">      <span class="token operator">&lt;</span>Persons result<span class="token operator">=</span><span class="token punctuation">{</span>result<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
      <span class="token operator">&lt;</span>Mutation
        mutation<span class="token operator">=</span><span class="token punctuation">{</span>createPerson<span class="token punctuation">}</span> 
        refetchQueries<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">{</span> query<span class="token punctuation">:</span> allPersons <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
        onError<span class="token operator">=</span><span class="token punctuation">{</span>handleError<span class="token punctuation">}</span>
      <span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token punctuation">(</span>addPerson<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
          <span class="token operator">&lt;</span>PersonForm
            addUser<span class="token operator">=</span><span class="token punctuation">{</span>addPerson<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Mutation<span class="token operator">&gt;</span>
      <span class="token comment">// ...</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p><i>Mutation</i>-komponentit saadaan korvattua hookin <em>useMutation</em> avulla. Komponentin <i>App</i> lopullinen muoto on seuraava:</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="gatsby-highlight-code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useQuery<span class="token punctuation">,</span> useMutation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-apollo-hooks&#x27;</span></span>
<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token constant">ALL_PERSONS</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>errorMessage<span class="token punctuation">,</span> setErrorMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">handleError</span> <span class="token operator">=</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> addPerson <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span><span class="token constant">CREATE_PERSON</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    onError<span class="token punctuation">:</span> handleError<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    refetchQueries<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> query<span class="token punctuation">:</span> <span class="token constant">ALL_PERSONS</span> <span class="token punctuation">}</span><span class="token punctuation">]</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> editNumber <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span><span class="token constant">EDIT_NUMBER</span><span class="token punctuation">)</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>errorMessage <span class="token operator">&amp;&amp;</span>
        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">&#x27;red&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>errorMessage<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>Persons result<span class="token operator">=</span><span class="token punctuation">{</span>result<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>create <span class="token keyword">new</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
<span class="gatsby-highlight-code-line">      <span class="token operator">&lt;</span>PersonForm addPerson<span class="token operator">=</span><span class="token punctuation">{</span>addPerson<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>change number<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
<span class="gatsby-highlight-code-line">      <span class="token operator">&lt;</span>PhoneForm editNumber<span class="token operator">=</span><span class="token punctuation">{</span>editNumber<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Lopputulos on todellakin monin verroin selkeämpi kun render props -komponentteja käyttävä sotku. Voimme yhtyä Ryan Florencen React Confissa 2018 esittämään mielipiteeseen <a href="https://www.youtube.com/watch?v=wXLf18DsV-I">90% Cleaner React With Hooks</a>.</p>
<p>Apollo-tiimi on lupaillut että suora hook-tuki ilmestyy kevään aikana. Ennen suoran tuen toteuttamista voi jo melko turvallisin mielin käyttää kirjastoa <a href="https://github.com/trojanowski/react-apollo-hooks">react-apollo-hooks</a>.</p>
<p>Koska render props -komponenteista on päästy kokonaan eroon, yksinkertaistuu <i>inder.js</i> seuraavasti</p>
<div class="gatsby-highlight" data-language="js"><pre><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&#x27;react-dom&#x27;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#x27;./App&#x27;</span>

<span class="token keyword">import</span> ApolloClient <span class="token keyword">from</span> <span class="token string">&#x27;apollo-boost&#x27;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react-apollo-hooks&#x27;</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  uri<span class="token punctuation">:</span> <span class="token string">&#x27;http://localhost:4000/graphql&#x27;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>ApolloProvider client<span class="token operator">=</span><span class="token punctuation">{</span>client<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>ApolloProvider<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;root&#x27;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre></div>
<p>Sovelluksen kirjastoa react-apollo-hooks käyttävä koodi on kokonaisuudessaan <a href="https://github.com/fullstack-hy2019/graphql-phonebook-frontend/tree/part8-5">githubissa</a>, branchissa <i>part8-5</i>.</p>
</div></div>
<div class="banner spacing spacing--after tasks" style="background-color:#82F7EB"><div class="container"><div class="course-content col-6 push-right-3" style="border-color:#82F7EB;background-color:transparent">
<h3>Tehtäviä</h3>
<p>Tehtävissä toteutetaan GraphQL-kirjastolle fronend.</p>
<p>Ota sovelluksesi lähtökohtaksi <a href="https://github.com/fullstack-hy2019/library-frontend">tämä projekti</a>.</p>
<p>Voit tehdä sovelluksesi joko käyttäen Apollo Clientin render prop -komponentteja <i>Query</i> ja <i>Mutation</i> tai käyttää kirjastoa <a href="https://github.com/trojanowski/react-apollo-hooks">react-apollo-hooks</a>.</p>
<h4>8.8: Kirjailijoiden näkymä</h4>
<p>Toteuta kirjailijoiden näkymä, eli näytä sivulla kaikkien kirjailijoiden tiedot esim. seuraavasti</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/cd63490814854dddf60e7863239c3276/14be6/16.png"/></picture>
<h4>8.9: Kirjojen näkymä</h4>
<p>Toteuta kirjojen näkymä, eli näytä sivulla kirjoista muut tiedot paitsi genret</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/8aee30985901fcee02edb80db9a31557/14be6/17.png"/></picture>
<h4>8.10: Kirjan lisäys</h4>
<p>Toteuta sovellukseen mahdollisuus uusien kirjojen lisäämiseen. Voit tehdä sovellukseen lisäystä varten oman &quot;näkymän&quot;, samalla logiikalla kuin kirjailijoiden ja kirjojen näkymät on tehty. Toiminnallisuus voi näyttää seuraavalta</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/80c3fc1431e121db93a23f1b306bb64f/14be6/18.png"/></picture>
<p>Huolehdi siitä, että kirjailijoiden ja kirjojen näkymä pysyy ajantasaisena lisäyksen jälkeen.</p>
<h4>8.11: Kirjailijan syntymävuosi</h4>
<p>Tee sovellukseen mahdollisuus asettaa kirjailijalle syntymävuosi. Voit tehdä syntymävuoden asettamista varten oman näkymän tai sijoittaa sen kirjailijat näyttävälle sivulle:</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/924bdbe2b19fd91f5ea4092feddee1d5/14be6/20.png"/></picture>
<p>Huolehdi siitä, että kirjailijoiden näkymä pysyy ajantasaisena lisäyksen jälkeen.</p>
<h4>8.12: Kirjailijan syntymävuosi advanced</h4>
<p>Tee syntymävuoden asetuslomakkeesta <a href="https://reactjs.org/docs/forms.html#the-select-tag">select-tagin</a>, kirjaston <a href="https://github.com/JedWatson/react-select">react-select</a> tai jonkun muun mekanismin avulla sellainen, että syntymävuoden voi asettaa ainoastaan olemassaolevalle kirjailijalle. </p>
<p>react-select-kirjastoa hyödyntävä ratkaisu näyttää seuraavalta</p>
<picture><img style="border-color:#82F7EB" alt="fullstack content" src="/static/a3ccc596485cf42701e33848460102d1/14be6/21.png"/></picture>
</div></div></div></div><div class="container spacing element--flex element--centered"><a class="edit-link" target="__BLANK" href="https://github.com/fullstack-hy2019/fullstack-hy2019.github.io/edit/source/src/content/osa8/osa8b.md">Ehdota muutosta materiaalin sisältöön</a></div><div class="container spacing spacing--after-large prev-next__container "><a class="col-4--mobile push-right-1 prev" href="/osa8/graph_ql_palvelin"><div class=" element--flex element--column"><p>Osa <!-- -->8a</p><b>Edellinen osa</b></div></a><div class="col-1--mobile separator"></div><a class="col-4--mobile push-left-1 next" href="/osa8/tietokanta_ja_kayttajien_hallinta"><div class=" element--flex element--column"><p>Osa <!-- -->8c</p><b>Seuraava osa</b></div></a></div></div><div class="container spacing--after-small spacing--mobile element--flex" id="footer"><div class="col-5 col-10--mobile order-2--mobile footer__links element--flex element--space-between"><a href="https://www.helsinki.fi/" class="col-5 col-4--mobile spacing--mobile"><div class="image col-6 image--contain"><div class="image__container"><img style="background-color:;background-opacity:0.5" class="image__content" src="/static/hgin_yliopisto-30c68104749d830b6cef6ea8c6339b16.png" alt="Helsingin yliopiston logo"/></div></div></a><a href="https://www.houston-inc.com/" class="col-5 col-4--mobile spacing--mobile"><div class="image col-6 image--contain"><div class="image__container"><img style="background-color:;background-opacity:0.5" class="image__content" src="/static/houston_logo-356bd2a9a75b44bdf7897b2cdd387600.png" alt="Houston inc. logo"/></div></div></a></div><div class="col-5 col-5--mobile order-1--mobile footer__navigation element--flex"><a class="footer__navigation-link nav-item-hover col-10--mobile" style="margin-left:4.5rem" href="/about">KURSSISTA</a><a class="footer__navigation-link nav-item-hover col-10--mobile" style="margin-left:4.5rem" href="/#course-contents">KURSSIN SISÄLTÖ</a><a class="footer__navigation-link nav-item-hover col-10--mobile" style="margin-left:4.5rem" href="/faq">FAQ</a></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-content-template-js","jsonName":"osa-8-react-ja-graph-ql-986","path":"/osa8/react_ja_graph_ql"};window.dataPath="407/path---osa-8-react-ja-graph-ql-986-8bc-EUrDmdBRAG5T7oEW5L5bROR79oc";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.f588656cc80a065e5f1e.css","/app-77e4e50dff4a402760b9.js"],"component---src-templates-part-intro-template-js":["/component---src-templates-part-intro-template-js.f89e77c0788c3b42eb99.css","/component---src-templates-part-intro-template-js-99c3379e0c85f98af85b.js"],"component---src-templates-content-template-js":["/component---src-templates-content-template-js.59a575ad88fdbaeba17d.css","/component---src-templates-content-template-js-45199be9da0474ef210f.js"],"component---src-pages-404-js":["/component---src-pages-404-js.8d4a7977feb76fc76984.css","/component---src-pages-404-js-64d6fadd34eefb01c89d.js"],"component---src-pages-about-js":["/component---src-pages-about-js.9b307033bd4c3b127e05.css","/component---src-pages-about-js-60073a8a253b3920844e.js"],"component---src-pages-companies-js":["/component---src-pages-companies-js.150fce7cfbe4cb867585.css","/component---src-pages-companies-js-0c6d541d51f8a8346648.js"],"component---src-pages-faq-js":["/component---src-pages-faq-js.97fa9f467f8483b003af.css","/component---src-pages-faq-js-92a071fe192efb45748d.js"],"component---src-pages-index-js":["/component---src-pages-index-js.54fb40b9e036e2b0b9a4.css","/component---src-pages-index-js-a1b90ca08286fe94b33e.js"]};/*]]>*/</script><script src="/webpack-runtime-2ffd64c747c510276057.js" async=""></script><script src="/3-581fe0821230e9175114.js" async=""></script><script src="/0-87340ba4bd0a15678a60.js" async=""></script><script src="/2-8cb475ac5ceeb60d8393.js" async=""></script><script src="/component---src-templates-content-template-js-45199be9da0474ef210f.js" async=""></script><script src="/1-072e5cd30afe3d25b43a.js" async=""></script><script src="/app-77e4e50dff4a402760b9.js" async=""></script></body></html>